<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0c0c1a" id="metaTheme">
<meta name="description" content="MyKharcha ‚Äì Smart Expense Tracker">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MyKharcha">
<title>MyKharcha ‚Äì Smart Expense Tracker</title>
<link rel="manifest" id="manifestLink">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Outfit:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
/* ‚îÄ‚îÄ VARIABLES ‚îÄ‚îÄ */
:root{
  --bg:#0c0c1a; --bg2:#111125; --bg3:#181830;
  --card:rgba(255,255,255,.05); --card-h:rgba(255,255,255,.09);
  --bdr:rgba(255,255,255,.08); --bdr-h:rgba(139,127,255,.4);
  --txt:#eeeeff; --txt2:rgba(180,180,220,.75); --txt3:rgba(140,140,180,.5);
  --purple:#8b7fff; --pdim:rgba(139,127,255,.15);
  --blue:#4db8ff;  --bdim:rgba(77,184,255,.13);
  --green:#4dffb8; --gdim:rgba(77,255,184,.13);
  --red:#ff5f7e;   --rdim:rgba(255,95,126,.13);
  --orange:#ffaa4d;--odim:rgba(255,170,77,.13);
  --gm:linear-gradient(135deg,#8b7fff,#4db8ff);
  --gi:linear-gradient(135deg,#4dffb8,#4db8ff);
  --ge:linear-gradient(135deg,#ff5f7e,#ffaa4d);
  --gw:linear-gradient(135deg,#ffaa4d,#ff6bda);
  --r1:24px; --r2:18px; --r3:14px; --r4:10px;
  --sh:0 8px 40px rgba(0,0,0,.5);
  --t:.25s cubic-bezier(.4,0,.2,1);
  --ts:.4s cubic-bezier(.34,1.56,.64,1);
}
[data-theme=light]{
  --bg:#f0f0f8; --bg2:#e8e8f5; --bg3:#fff;
  --card:rgba(255,255,255,.8); --card-h:rgba(255,255,255,1);
  --bdr:rgba(0,0,0,.07); --bdr-h:rgba(139,127,255,.4);
  --txt:#1a1a2e; --txt2:rgba(40,40,80,.7); --txt3:rgba(80,80,120,.5);
  --pdim:rgba(139,127,255,.12); --bdim:rgba(77,184,255,.12);
  --gdim:rgba(77,255,184,.12); --rdim:rgba(255,95,126,.12); --odim:rgba(255,170,77,.12);
  --sh:0 4px 24px rgba(100,100,160,.15);
}
/* ‚îÄ‚îÄ RESET ‚îÄ‚îÄ */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{font-size:16px;height:100%}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--txt);min-height:100svh;overflow-x:hidden;transition:background .3s,color .3s;-webkit-font-smoothing:antialiased}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 60% 40% at 20% 10%,rgba(139,127,255,.07) 0%,transparent 60%),radial-gradient(ellipse 50% 35% at 80% 85%,rgba(77,184,255,.05) 0%,transparent 60%)}
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-thumb{background:var(--purple);border-radius:2px}
input,select,textarea,button{font-family:inherit}
input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none}
/* ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ */
#app{position:relative;z-index:1;max-width:430px;margin:0 auto;min-height:100svh}
/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.hdr{position:sticky;top:0;z-index:200;padding:13px 16px 10px;background:rgba(12,12,26,.9);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;transition:background .3s}
[data-theme=light] .hdr{background:rgba(240,240,248,.92)}
.hdr-brand .logo{font-family:'Outfit',sans-serif;font-size:20px;font-weight:900;letter-spacing:-.5px;background:var(--gm);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hdr-brand .sub{font-size:10px;color:var(--txt3);margin-top:1px}
.hdr-acts{display:flex;gap:8px;align-items:center}
.hbtn{width:36px;height:36px;border-radius:var(--r3);border:1px solid var(--bdr);background:var(--card);color:var(--txt);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--t);position:relative;flex-shrink:0}
.hbtn:hover{background:var(--pdim);border-color:var(--purple);color:var(--purple)}
.hbtn .material-icons-round{font-size:18px}
.hbtn .dot{position:absolute;top:-3px;right:-3px;width:8px;height:8px;border-radius:50%;background:var(--red);border:2px solid var(--bg);display:none}
.hbtn .dot.on{display:block}
/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page{display:none;padding-bottom:85px;min-height:calc(100svh - 60px)}
.page.active{display:block;animation:fadeUp .3s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.pg{padding:14px 15px;display:flex;flex-direction:column;gap:13px}
/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bnav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;background:rgba(12,12,26,.95);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-top:1px solid var(--bdr);display:flex;z-index:300;padding:5px 0 max(6px,env(safe-area-inset-bottom))}
[data-theme=light] .bnav{background:rgba(240,240,248,.95)}
.nbtn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:5px 2px;border:none;background:none;color:var(--txt3);font-size:9px;font-weight:700;cursor:pointer;transition:var(--t);text-transform:uppercase;letter-spacing:.3px;position:relative}
.nbtn.on{color:var(--purple)}
.nbtn.on .niw{background:var(--pdim)}
.niw{width:34px;height:26px;border-radius:8px;display:flex;align-items:center;justify-content:center;transition:var(--t)}
.nbtn:hover .niw{background:var(--pdim)}
.nbtn .material-icons-round{font-size:21px}
.nbtn .rdot{position:absolute;top:3px;right:calc(50% - 17px);width:6px;height:6px;border-radius:50%;background:var(--red);display:none}
.nbtn .rdot.on{display:block}
/* ‚îÄ‚îÄ FAB ‚îÄ‚îÄ */
.fab{position:fixed;bottom:70px;right:max(16px,calc(50% - 215px + 16px));width:52px;height:52px;border-radius:18px;background:var(--gm);border:none;color:#fff;cursor:pointer;box-shadow:0 8px 28px rgba(139,127,255,.5);display:flex;align-items:center;justify-content:center;z-index:250;transition:var(--ts)}
.fab:hover{transform:scale(1.1) translateY(-2px);box-shadow:0 14px 36px rgba(139,127,255,.6)}
.fab:active{transform:scale(.94)}
.fab .material-icons-round{font-size:26px}
/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r1);backdrop-filter:blur(10px);overflow:hidden}
.cp{padding:17px}
/* ‚îÄ‚îÄ HERO CARD ‚îÄ‚îÄ */
.hero{background:var(--gm);border-radius:var(--r1);padding:20px;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;top:-40px;right:-40px;width:130px;height:130px;background:rgba(255,255,255,.1);border-radius:50%}
.hero::after{content:'';position:absolute;bottom:-25px;left:25px;width:85px;height:85px;background:rgba(255,255,255,.06);border-radius:50%}
.hero .hl{font-size:11px;font-weight:600;color:rgba(255,255,255,.75);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px}
.hero .ha{font-family:'Outfit',sans-serif;font-size:40px;font-weight:900;color:#fff;line-height:1;position:relative;z-index:1}
.hero .hs{font-size:12px;color:rgba(255,255,255,.65);margin-top:3px}
.hero-row{display:flex;gap:8px;margin-top:16px;position:relative;z-index:1}
.hstat{flex:1;background:rgba(255,255,255,.17);border-radius:13px;padding:9px 11px}
.hstat .sl{font-size:9px;color:rgba(255,255,255,.7);text-transform:uppercase;letter-spacing:.4px}
.hstat .sv{font-family:'Outfit',sans-serif;font-size:15px;font-weight:800;color:#fff;margin-top:2px}
.lstrip{position:relative;z-index:1;margin-top:13px}
.lrow{display:flex;justify-content:space-between;font-size:10px;color:rgba(255,255,255,.75);margin-bottom:5px}
.ltrack{height:5px;background:rgba(255,255,255,.2);border-radius:3px;overflow:hidden}
.lfill{height:100%;border-radius:3px;background:rgba(255,255,255,.9);transition:width .7s ease}
.lfill.over{background:#ffdd57}
/* ‚îÄ‚îÄ STAT MINIS ‚îÄ‚îÄ */
.sgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.smini{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2);padding:14px;transition:var(--t)}
.smini:hover{border-color:var(--bdr-h)}
.smini .ico{width:33px;height:33px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:9px}
.smini .ico .material-icons-round{font-size:17px}
.smini .lbl{font-size:10px;color:var(--txt3);text-transform:uppercase;letter-spacing:.5px;font-weight:600}
.smini .val{font-family:'Outfit',sans-serif;font-size:20px;font-weight:800;margin-top:3px;line-height:1}
.smini.inc{border-color:rgba(77,255,184,.15)}.smini.inc .ico{background:var(--gdim)}.smini.inc .ico .material-icons-round{color:var(--green)}.smini.inc .val{color:var(--green)}
.smini.sav .ico{background:var(--bdim)}.smini.sav .ico .material-icons-round{color:var(--blue)}.smini.sav .val{color:var(--blue)}
/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.sh{display:flex;align-items:center;justify-content:space-between;margin-bottom:11px}
.sh h2{font-family:'Outfit',sans-serif;font-size:16px;font-weight:800}
.sh .sa{font-size:11px;font-weight:700;color:var(--purple);cursor:pointer}
/* ‚îÄ‚îÄ CATEGORY ROW ‚îÄ‚îÄ */
.clist{display:flex;flex-direction:column;gap:7px}
.crow{display:flex;align-items:center;gap:10px;padding:9px 12px;background:var(--card);border:1px solid var(--bdr);border-radius:var(--r3);transition:var(--t)}
.crow:hover{border-color:var(--bdr-h);background:var(--card-h)}
.crow .ci{width:30px;height:30px;border-radius:9px;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.crow .ci .material-icons-round{font-size:14px}
.crow .cm{flex:1;min-width:0}
.crow .cn{font-size:12px;font-weight:700}
.cpbar{height:3px;background:var(--bdr);border-radius:2px;overflow:hidden;margin-top:4px}
.cpfill{height:100%;border-radius:2px;transition:width .8s ease}
.crow .cp2{font-size:10px;color:var(--txt3);font-weight:600}
.crow .ca{font-family:'Outfit',sans-serif;font-size:13px;font-weight:800}
/* ‚îÄ‚îÄ TRANSACTION ‚îÄ‚îÄ */
.tlist{display:flex;flex-direction:column;gap:7px}
.txn{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2);padding:12px 13px;display:flex;align-items:center;gap:10px;transition:var(--t);position:relative;overflow:hidden}
.txn::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;opacity:0;transition:var(--t)}
.txn:hover{border-color:var(--bdr-h);background:var(--card-h);transform:translateX(2px)}
.txn:hover::before{opacity:1}
.txn.ex::before{background:var(--red)}.txn.in::before{background:var(--green)}
.tico{width:40px;height:40px;border-radius:12px;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.tico .material-icons-round{font-size:18px}
.tbody{flex:1;min-width:0}
.tbody .tc{font-size:13px;font-weight:700;display:flex;align-items:center;gap:5px;flex-wrap:wrap}
.tbody .tn{font-size:11px;color:var(--txt3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px}
.tbody .tt{font-size:10px;color:var(--txt3);margin-top:1px}
.tright{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0}
.tamt{font-family:'Outfit',sans-serif;font-size:16px;font-weight:900;white-space:nowrap}
.tamt.ex{color:var(--red)}.tamt.in{color:var(--green)}
.tacts{display:flex;gap:3px}
.tabtn{width:26px;height:26px;border-radius:7px;border:1px solid var(--bdr);background:transparent;color:var(--txt3);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--t)}
.tabtn .material-icons-round{font-size:13px}
.tabtn:hover.ed{color:var(--blue);border-color:var(--blue);background:var(--bdim)}
.tabtn:hover.dl{color:var(--red);border-color:var(--red);background:var(--rdim)}
.tabtn:hover.wa{color:var(--green);border-color:var(--green);background:var(--gdim)}
/* ‚îÄ‚îÄ TAGS ‚îÄ‚îÄ */
.tag{display:inline-flex;align-items:center;padding:2px 7px;border-radius:5px;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.3px;white-space:nowrap}
.tag.cash{background:var(--gdim);color:var(--green)}.tag.upi{background:var(--bdim);color:var(--blue)}.tag.card{background:var(--odim);color:var(--orange)}.tag.income-tag{background:var(--gdim);color:var(--green)}
/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty{text-align:center;padding:44px 20px;color:var(--txt3)}
.empty .material-icons-round{font-size:52px;display:block;margin-bottom:10px;opacity:.2}
.empty h3{font-size:15px;font-weight:700;margin-bottom:5px;color:var(--txt2)}
.empty p{font-size:12px}
/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.ov{position:fixed;inset:0;z-index:500;background:rgba(0,0,0,.78);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s}
.ov.open{opacity:1;pointer-events:all}
.modal{width:100%;max-width:430px;background:var(--bg2);border-radius:26px 26px 0 0;border:1px solid var(--bdr);border-bottom:none;max-height:92svh;overflow-y:auto;transform:translateY(100%);transition:transform .38s cubic-bezier(.32,.72,0,1);padding-bottom:max(18px,env(safe-area-inset-bottom))}
.ov.open .modal{transform:translateY(0)}
.mhdl{width:36px;height:4px;background:var(--bdr);border-radius:2px;margin:10px auto 0}
.mhdr{padding:13px 17px 11px;display:flex;align-items:center;justify-content:space-between}
.mhdr h2{font-family:'Outfit',sans-serif;font-size:20px;font-weight:900}
.mcls{width:31px;height:31px;border-radius:8px;border:1px solid var(--bdr);background:var(--card);color:var(--txt2);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--t)}
.mcls:hover{background:var(--rdim);border-color:var(--red);color:var(--red)}
.mcls .material-icons-round{font-size:15px}
.mbody{padding:0 17px}
/* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
.tg{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}
.tbtn{padding:10px;border-radius:var(--r3);border:1px solid var(--bdr);background:var(--card);color:var(--txt3);font-size:13px;font-weight:700;cursor:pointer;transition:var(--t);display:flex;align-items:center;justify-content:center;gap:5px}
.tbtn .material-icons-round{font-size:15px}
.tbtn.ae{background:var(--rdim);border-color:var(--red);color:var(--red)}
.tbtn.ai{background:var(--gdim);border-color:var(--green);color:var(--green)}
.fg{margin-bottom:14px}
.fl{display:block;font-size:11px;font-weight:700;color:var(--txt3);text-transform:uppercase;letter-spacing:.6px;margin-bottom:7px}
.fi,.fs,.fta{width:100%;background:var(--card);border:1px solid var(--bdr);border-radius:var(--r3);padding:11px 13px;color:var(--txt);font-size:14px;outline:none;transition:var(--t);-webkit-appearance:none;appearance:none}
.fi:focus,.fs:focus,.fta:focus{border-color:var(--purple);box-shadow:0 0 0 3px rgba(139,127,255,.12)}
.fta{resize:none;min-height:72px}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.awrap{position:relative}
.apfx{position:absolute;left:13px;top:50%;transform:translateY(-50%);font-family:'Outfit',sans-serif;font-size:22px;font-weight:800;color:var(--purple);pointer-events:none}
.afi{width:100%;background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2);padding:15px 13px 15px 36px;color:var(--txt);font-family:'Outfit',sans-serif;font-size:30px;font-weight:900;outline:none;transition:var(--t)}
.afi:focus{border-color:var(--purple);box-shadow:0 0 0 3px rgba(139,127,255,.12)}
.afi::placeholder{color:var(--txt3);font-weight:400}
/* chips */
.cwrap{display:flex;flex-wrap:wrap;gap:6px}
.cc{padding:6px 11px;border-radius:18px;border:1px solid var(--bdr);background:var(--card);color:var(--txt3);font-size:11px;font-weight:700;cursor:pointer;transition:var(--t);display:flex;align-items:center;gap:4px}
.cc .material-icons-round{font-size:13px}
.cc:hover{border-color:var(--purple);color:var(--purple)}
.cc.sel{background:var(--pdim);border-color:var(--purple);color:var(--purple)}
.pwrap{display:flex;gap:8px}
.pc{flex:1;padding:9px 4px;border-radius:var(--r3);text-align:center;border:1px solid var(--bdr);background:var(--card);color:var(--txt3);font-size:11px;font-weight:700;cursor:pointer;transition:var(--t)}
.pc.sel{background:var(--bdim);border-color:var(--blue);color:var(--blue)}
/* submit btn */
.sbtn{width:100%;padding:14px;background:var(--gm);border:none;border-radius:var(--r2);color:#fff;font-family:'Outfit',sans-serif;font-size:16px;font-weight:800;cursor:pointer;transition:var(--t);margin-top:5px;box-shadow:0 8px 28px rgba(139,127,255,.4);letter-spacing:.3px}
.sbtn:hover{transform:translateY(-2px);box-shadow:0 14px 36px rgba(139,127,255,.55)}
.sbtn:active{transform:translateY(0)}
.sbtn.dng{background:var(--ge);box-shadow:0 8px 24px rgba(255,95,126,.3)}
.sbtn.grn{background:linear-gradient(135deg,#25D366,#128C7E)}
.mb{margin-bottom:12px}
/* ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ */
.swrap{position:relative}
.swrap .material-icons-round{position:absolute;left:11px;top:50%;transform:translateY(-50%);color:var(--txt3);font-size:17px;pointer-events:none}
.sbar{width:100%;background:var(--card);border:1px solid var(--bdr);border-radius:var(--r3);padding:10px 12px 10px 36px;color:var(--txt);font-size:13px;outline:none;transition:var(--t)}
.sbar:focus{border-color:var(--purple)}
.fscroll{display:flex;gap:6px;overflow-x:auto;padding-bottom:3px;-webkit-overflow-scrolling:touch}
.fscroll::-webkit-scrollbar{display:none}
.fc{padding:6px 12px;border-radius:16px;white-space:nowrap;flex-shrink:0;border:1px solid var(--bdr);background:var(--card);color:var(--txt3);font-size:11px;font-weight:700;cursor:pointer;transition:var(--t)}
.fc.on{background:var(--pdim);border-color:var(--purple);color:var(--purple)}
.drow{display:flex;gap:8px;align-items:center}
.drow .fi{flex:1;padding:9px 11px;font-size:12px}
.cbtn{padding:9px 13px;border-radius:var(--r3);background:var(--card);border:1px solid var(--bdr);color:var(--txt2);font-size:12px;font-weight:700;cursor:pointer;transition:var(--t);white-space:nowrap}
.cbtn:hover{border-color:var(--purple);color:var(--purple)}
.dgrp{margin-bottom:14px}
.dlbl{display:flex;justify-content:space-between;padding:0 2px;margin-bottom:7px}
.dlbl .dl{font-size:12px;font-weight:700;color:var(--txt2)}
.dlbl .dr{font-family:'Outfit',sans-serif;font-size:13px;font-weight:800;color:var(--red)}
/* ‚îÄ‚îÄ REPORTS ‚îÄ‚îÄ */
.mnav{display:flex;align-items:center;justify-content:space-between;padding:11px 15px;background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2)}
.mbtn{background:var(--card);border:1px solid var(--bdr);color:var(--txt);border-radius:var(--r4);padding:6px 13px;font-size:12px;font-weight:700;cursor:pointer;transition:var(--t)}
.mbtn:hover{background:var(--pdim);border-color:var(--purple);color:var(--purple)}
.mtit{font-family:'Outfit',sans-serif;font-size:15px;font-weight:800}
.ccard{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r1);padding:17px}
.ccard h3{font-family:'Outfit',sans-serif;font-size:14px;font-weight:800;margin-bottom:14px;color:var(--txt2)}
.cbox{position:relative;height:190px}
.egrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.ebtn{padding:12px;border-radius:var(--r3);border:1px solid var(--bdr);background:var(--card);color:var(--txt);font-size:12px;font-weight:700;cursor:pointer;transition:var(--t);display:flex;align-items:center;justify-content:center;gap:7px}
.ebtn:hover{background:var(--pdim);border-color:var(--purple)}
.ebtn .material-icons-round{font-size:17px;color:var(--purple)}
/* ‚îÄ‚îÄ BILLS ‚îÄ‚îÄ */
.bcard{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2);padding:13px 14px;display:flex;align-items:center;gap:11px;transition:var(--t);margin-bottom:7px;position:relative;overflow:hidden}
.bcard::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px}
.bcard.dt::before{background:var(--red)}.bcard.ds::before{background:var(--orange)}.bcard.uc::before{background:var(--purple)}
.bcard:hover{border-color:var(--bdr-h);background:var(--card-h)}
.bico{width:38px;height:38px;border-radius:11px;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.bico .material-icons-round{font-size:18px}
.binfo{flex:1;min-width:0}
.binfo .bn{font-size:13px;font-weight:700}
.binfo .bd{font-size:11px;color:var(--txt3);margin-top:2px}
.bright{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0}
.bamt{font-family:'Outfit',sans-serif;font-size:15px;font-weight:800}
.bst{font-size:9px;font-weight:700;padding:3px 8px;border-radius:6px;text-transform:uppercase;letter-spacing:.3px}
.bst.tod{background:var(--rdim);color:var(--red)}.bst.sn{background:var(--odim);color:var(--orange)}.bst.ok{background:var(--gdim);color:var(--green)}.bst.pd{background:rgba(100,100,100,.15);color:var(--txt3)}
.bacts{display:flex;gap:3px;margin-top:2px}
/* ‚îÄ‚îÄ EMI ‚îÄ‚îÄ */
.ecard{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2);padding:15px;margin-bottom:8px;transition:var(--t)}
.ecard:hover{border-color:var(--bdr-h)}
.etop{display:flex;align-items:center;gap:11px;margin-bottom:11px}
.eico{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.eico .material-icons-round{font-size:17px;color:#fff}
.etit{flex:1;min-width:0}
.etit .en{font-size:13px;font-weight:700}
.etit .eb{font-size:11px;color:var(--txt3);margin-top:1px}
.etit .ea{font-family:'Outfit',sans-serif;font-size:15px;font-weight:800;color:var(--orange)}
.epbar{height:8px;background:var(--bdr);border-radius:4px;overflow:hidden;margin-bottom:5px}
.epfill{height:100%;background:var(--gm);border-radius:4px;transition:width .8s ease}
.eplbl{display:flex;justify-content:space-between;font-size:10px;color:var(--txt3);font-weight:600}
.etags{display:flex;gap:7px;flex-wrap:wrap;margin-top:8px}
.etag{padding:4px 9px;border-radius:7px;font-size:10px;font-weight:700;background:var(--bg2);border:1px solid var(--bdr)}
/* ‚îÄ‚îÄ BUDGET ‚îÄ‚îÄ */
.bhero{background:var(--gw);border-radius:var(--r1);padding:19px;position:relative;overflow:hidden}
.bhero::before{content:'';position:absolute;top:-30px;right:-30px;width:110px;height:110px;background:rgba(255,255,255,.1);border-radius:50%}
.bhl{font-size:11px;font-weight:600;color:rgba(255,255,255,.8);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.bha{font-family:'Outfit',sans-serif;font-size:35px;font-weight:900;color:#fff;line-height:1}
.bhs{font-size:11px;color:rgba(255,255,255,.7);margin-top:3px}
.bhrow{display:flex;gap:8px;margin-top:13px;position:relative;z-index:1}
.bhitem{flex:1;background:rgba(255,255,255,.18);border-radius:11px;padding:8px 10px}
.bhitem .bi{font-size:9px;color:rgba(255,255,255,.75);text-transform:uppercase;letter-spacing:.4px}
.bhitem .bv{font-family:'Outfit',sans-serif;font-size:15px;font-weight:800;color:#fff;margin-top:2px}
.bclist{display:flex;flex-direction:column;gap:8px}
.bcitem{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r3);padding:12px 14px;transition:var(--t)}
.bcitem:hover{border-color:var(--bdr-h)}
.bctop{display:flex;align-items:center;gap:9px;margin-bottom:7px}
.bcico{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.bcico .material-icons-round{font-size:13px}
.bcn{flex:1;font-size:12px;font-weight:700}
.bcp{font-size:10px;font-weight:700;color:var(--txt3)}
.bcamts{display:flex;justify-content:space-between;font-size:11px;margin-bottom:6px}
.bcsp{font-weight:700}.bcbg{color:var(--txt3)}
.bcbar{height:5px;background:var(--bdr);border-radius:3px;overflow:hidden}
.bcfill{height:100%;border-radius:3px;transition:width .8s ease}
.bcfill.sf{background:var(--green)}.bcfill.wn{background:var(--orange)}.bcfill.ov{background:var(--red)}
/* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
.sgt{font-size:10px;font-weight:800;color:var(--txt3);text-transform:uppercase;letter-spacing:1px;margin:4px 2px 7px}
.si{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2);padding:12px 14px;display:flex;align-items:center;gap:12px;transition:var(--t);cursor:pointer;margin-bottom:7px}
.si:hover{border-color:var(--bdr-h);background:var(--card-h)}
.sico{width:37px;height:37px;border-radius:11px;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.sico .material-icons-round{font-size:18px}
.sinf{flex:1}.sinf h4{font-size:13px;font-weight:700}.sinf p{font-size:11px;color:var(--txt3);margin-top:2px}
/* toggle */
.tgl{width:43px;height:23px;border-radius:12px;flex-shrink:0;background:var(--bdr);border:none;cursor:pointer;position:relative;transition:var(--t)}
.tgl.on{background:var(--purple)}
.tgl::after{content:'';position:absolute;left:3px;top:3px;width:17px;height:17px;border-radius:50%;background:#fff;box-shadow:0 2px 5px rgba(0,0,0,.3);transition:var(--t)}
.tgl.on::after{transform:translateX(20px)}
.lform{padding:12px 14px;background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2);margin-bottom:7px}
.linrow{display:flex;gap:8px;align-items:center}
.linp{flex:1;background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:9px 12px;color:var(--txt);font-family:'Outfit',sans-serif;font-size:15px;font-weight:700;outline:none;transition:var(--t)}
.linp:focus{border-color:var(--purple)}
.svbtn{padding:9px 15px;background:var(--gm);border:none;border-radius:10px;color:#fff;font-family:'Outfit',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:var(--t)}
.svbtn:hover{transform:scale(1.04)}
/* goals */
.gcard{background:var(--card);border:1px solid var(--bdr);border-radius:var(--r2);padding:13px;margin-bottom:7px}
.gtop{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.gname{font-size:13px;font-weight:700}.gamts{font-size:11px;color:var(--txt3);margin-top:2px}
.gbar{height:7px;background:var(--bdr);border-radius:4px;overflow:hidden}.gfill{height:100%;background:var(--gi);border-radius:4px;transition:width .8s ease}
.gpct{font-size:11px;color:var(--blue);font-weight:700;margin-top:5px}
.gdel{width:25px;height:25px;border-radius:7px;border:1px solid var(--bdr);background:transparent;color:var(--txt3);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--t);flex-shrink:0}
.gdel:hover{color:var(--red);border-color:var(--red);background:var(--rdim)}
.gdel .material-icons-round{font-size:13px}
.agbtn{width:100%;padding:11px;background:var(--card);border:1px dashed var(--bdr);border-radius:var(--r2);color:var(--txt3);font-size:13px;font-weight:700;cursor:pointer;transition:var(--t);display:flex;align-items:center;justify-content:center;gap:7px;margin-top:3px}
.agbtn:hover{border-color:var(--purple);color:var(--purple);background:var(--pdim)}
/* install banner */
.ibanner{background:linear-gradient(135deg,rgba(139,127,255,.12),rgba(77,184,255,.08));border:1px solid rgba(139,127,255,.25);border-radius:var(--r2);padding:11px 13px;display:flex;align-items:center;gap:10px}
.ibanner .material-icons-round{color:var(--purple);font-size:21px;flex-shrink:0}
.ibinfo{flex:1}.ibinfo h4{font-size:12px;font-weight:800}.ibinfo p{font-size:10px;color:var(--txt3);margin-top:1px}
.ibbtn{padding:7px 12px;background:var(--purple);border:none;border-radius:8px;color:#fff;font-size:11px;font-weight:800;cursor:pointer;white-space:nowrap;transition:var(--t)}
.ibbtn:hover{transform:scale(1.05)}
/* WA preview */
.wabox{background:#075E54;border-radius:14px;padding:14px;margin-bottom:13px}
.wahdr{font-size:10px;color:rgba(255,255,255,.6);margin-bottom:7px;text-transform:uppercase;letter-spacing:.5px}
.wamsg{background:#128C7E;border-radius:10px;padding:11px 13px;font-size:12px;color:#fff;line-height:1.65;white-space:pre-wrap;word-break:break-word}
/* ‚îÄ‚îÄ LOCK SCREEN ‚îÄ‚îÄ */
#lkscr{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:30px 24px}
.lklogo{font-family:'Outfit',sans-serif;font-size:26px;font-weight:900;background:var(--gm);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.lksub{font-size:12px;color:var(--txt3);margin-top:-14px}
.lkmeths{display:flex;flex-direction:column;align-items:center;gap:14px;width:100%;max-width:260px}
.fpbtn{width:76px;height:76px;border-radius:50%;background:var(--pdim);border:2px solid var(--purple);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--ts)}
.fpbtn:hover{transform:scale(1.08);box-shadow:0 0 28px rgba(139,127,255,.4)}
.fpbtn .material-icons-round{font-size:36px;color:var(--purple)}
.fpbtn.scanning{animation:pulse 1s infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(139,127,255,.4)}50%{box-shadow:0 0 0 18px transparent}}
.fplbl{font-size:12px;color:var(--txt3);text-align:center}
.lkor{font-size:11px;color:var(--txt3);width:100%;text-align:center;position:relative}
.lkor::before,.lkor::after{content:'';position:absolute;top:50%;width:36%;height:1px;background:var(--bdr)}
.lkor::before{left:0}.lkor::after{right:0}
.pdots{display:flex;gap:13px;margin:3px 0}
.pd{width:13px;height:13px;border-radius:50%;border:2px solid var(--purple);background:transparent;transition:var(--t)}
.pd.on{background:var(--purple);box-shadow:0 0 10px rgba(139,127,255,.6)}
.numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;width:220px}
.nb{aspect-ratio:1;border-radius:50%;background:var(--card);border:1px solid var(--bdr);color:var(--txt);font-family:'Outfit',sans-serif;font-size:21px;font-weight:800;cursor:pointer;transition:var(--ts);display:flex;align-items:center;justify-content:center}
.nb:hover{background:var(--pdim);border-color:var(--purple);color:var(--purple)}
.nb:active{transform:scale(.88)}
.pinerr{font-size:12px;color:var(--red);font-weight:700;height:15px;text-align:center}
/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast{position:fixed;top:72px;left:50%;transform:translateX(-50%) translateY(-130px);z-index:3000;background:var(--bg2);border:1px solid var(--bdr);border-radius:var(--r3);padding:10px 16px;font-size:12px;font-weight:700;display:flex;align-items:center;gap:8px;transition:transform .35s cubic-bezier(.34,1.56,.64,1);box-shadow:var(--sh);max-width:300px;white-space:nowrap}
#toast.on{transform:translateX(-50%) translateY(0)}
#toast.ok{border-color:rgba(77,255,184,.4);color:var(--green)}
#toast.err{border-color:rgba(255,95,126,.4);color:var(--red)}
#toast.warn{border-color:rgba(255,170,77,.4);color:var(--orange)}
#toast .material-icons-round{font-size:16px}
/* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
input[type=date],input[type=time]{color-scheme:dark}
[data-theme=light] input[type=date],[data-theme=light] input[type=time]{color-scheme:light}
.divider{height:1px;background:var(--bdr);margin:4px 0}
</style>
</head>
<body>

<!-- TOAST -->
<div id="toast"><span class="material-icons-round" id="tIco">check_circle</span><span id="tMsg">Done!</span></div>

<!-- LOCK SCREEN -->
<div id="lkscr" style="display:none">
  <div class="lklogo">MyKharcha</div>
  <div class="lksub">Smart Expense Tracker</div>
  <div class="lkmeths">
    <div style="text-align:center">
      <div class="fpbtn" id="fpbtn" onclick="tryFP()"><span class="material-icons-round">fingerprint</span></div>
      <div class="fplbl" id="fplbl" style="margin-top:8px">Fingerprint / Face ID tap karein</div>
    </div>
    <div class="lkor">ya PIN use karein</div>
    <div class="pdots"><div class="pd" id="pd0"></div><div class="pd" id="pd1"></div><div class="pd" id="pd2"></div><div class="pd" id="pd3"></div></div>
    <div class="pinerr" id="pinerr"></div>
    <div class="numpad" id="numpad"></div>
  </div>
</div>

<!-- APP -->
<div id="app">

  <!-- HEADER -->
  <header class="hdr">
    <div class="hdr-brand">
      <div class="logo">MyKharcha</div>
      <div class="sub" id="hdrDate">Loading...</div>
    </div>
    <div class="hdr-acts">
      <button class="hbtn" onclick="switchPg('bills')" title="Bill Reminders">
        <span class="material-icons-round">notifications</span>
        <span class="dot" id="notifDot"></span>
      </button>
      <button class="hbtn" onclick="toggleTheme()" title="Theme">
        <span class="material-icons-round" id="thIco">light_mode</span>
      </button>
      <button class="hbtn" onclick="openM('addModal')">
        <span class="material-icons-round">add</span>
      </button>
    </div>
  </header>

  <!-- ‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê -->
  <div id="pg-dash" class="page active">
    <div class="pg">
      <div id="installBanner" class="ibanner" style="display:none">
        <span class="material-icons-round">install_mobile</span>
        <div class="ibinfo"><h4>Install MyKharcha</h4><p>Home screen pe add karein</p></div>
        <button class="ibbtn" onclick="doInstall()">Install</button>
      </div>
      <!-- Hero -->
      <div class="hero">
        <div class="hl">Is Mahine ka Balance</div>
        <div class="ha" id="heroAmt">‚Çπ0</div>
        <div class="hs" id="heroSub">Amdani ‚àí Kharcha</div>
        <div class="hero-row">
          <div class="hstat"><div class="sl">Aaj</div><div class="sv" id="todayAmt">‚Çπ0</div></div>
          <div class="hstat"><div class="sl">Mahina</div><div class="sv" id="monthAmt">‚Çπ0</div></div>
          <div class="hstat"><div class="sl">Txns</div><div class="sv" id="txnCnt">0</div></div>
        </div>
        <div class="lstrip" id="lstrip" style="display:none">
          <div class="lrow"><span>Daily Limit</span><span id="ltxt"></span></div>
          <div class="ltrack"><div class="lfill" id="lfill"></div></div>
        </div>
      </div>
      <!-- Income / Savings -->
      <div class="sgrid">
        <div class="smini inc">
          <div class="ico"><span class="material-icons-round">trending_up</span></div>
          <div class="lbl">Amdani</div><div class="val" id="incAmt">‚Çπ0</div>
        </div>
        <div class="smini sav">
          <div class="ico"><span class="material-icons-round">savings</span></div>
          <div class="lbl">Bachat</div><div class="val" id="savAmt">‚Çπ0</div>
        </div>
      </div>
      <!-- Upcoming Bills -->
      <div id="dashBillsWrap" style="display:none">
        <div class="sh"><h2>üìÖ Aane Wale Bills</h2><span class="sa" onclick="switchPg('bills')">Sab Dekho ‚Üí</span></div>
        <div id="dashBillsList"></div>
      </div>
      <!-- Categories -->
      <div class="card cp">
        <div class="sh"><h2>Categories</h2><span class="sa" onclick="switchPg('reports')">Report ‚Üí</span></div>
        <div class="clist" id="catSummary"></div>
      </div>
      <!-- Recent -->
      <div>
        <div class="sh"><h2>Recent Transactions</h2><span class="sa" onclick="switchPg('history')">Sab Dekho ‚Üí</span></div>
        <div class="tlist" id="recentTxns"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê HISTORY ‚ïê‚ïê‚ïê -->
  <div id="pg-history" class="page">
    <div class="pg">
      <div class="swrap">
        <span class="material-icons-round">search</span>
        <input class="sbar" id="searchInp" placeholder="Note se search karein..." oninput="renderHistory()">
      </div>
      <div class="fscroll" id="catFilters"></div>
      <div class="drow">
        <input type="date" class="fi" id="dateFilter" onchange="renderHistory()">
        <button class="cbtn" onclick="clearDateFilter()">Clear</button>
      </div>
      <div id="histContent"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê REPORTS ‚ïê‚ïê‚ïê -->
  <div id="pg-reports" class="page">
    <div class="pg">
      <div class="mnav">
        <button class="mbtn" onclick="chgMonth(-1)">‚Äπ Pichla</button>
        <div class="mtit" id="rMonthTitle"></div>
        <button class="mbtn" onclick="chgMonth(1)">Agla ‚Ä∫</button>
      </div>
      <div class="ccard"><h3>üìä 6 Mahine ka Kharcha</h3><div class="cbox"><canvas id="barChart"></canvas></div></div>
      <div class="ccard"><h3>üç© Category Breakdown</h3><div class="cbox"><canvas id="pieChart"></canvas></div></div>
      <div class="ccard"><h3>üìà Daily Trend</h3><div class="cbox"><canvas id="lineChart"></canvas></div></div>
      <div class="card cp">
        <div class="sh"><h2>Export & Backup</h2></div>
        <div class="egrid">
          <button class="ebtn" onclick="exportPDF()"><span class="material-icons-round">picture_as_pdf</span>PDF Export</button>
          <button class="ebtn" onclick="exportXLSX()"><span class="material-icons-round">table_chart</span>Excel Export</button>
          <button class="ebtn" onclick="doBackup()"><span class="material-icons-round">backup</span>Backup JSON</button>
          <button class="ebtn" onclick="document.getElementById('restoreInp').click()"><span class="material-icons-round">restore</span>Restore Data</button>
        </div>
        <input type="file" id="restoreInp" accept=".json" style="display:none" onchange="doRestore(event)">
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê BILLS ‚ïê‚ïê‚ïê -->
  <div id="pg-bills" class="page">
    <div class="pg">
      <div class="sh"><h2>üìÖ Bill Reminders</h2><span class="sa" onclick="openM('billModal')">+ Add Bill</span></div>
      <div class="fscroll" id="billFilters">
        <div class="fc on" data-bf="all" onclick="setBF(this)">Sab</div>
        <div class="fc" data-bf="today" onclick="setBF(this)">üî¥ Aaj Due</div>
        <div class="fc" data-bf="week" onclick="setBF(this)">üü† Is Hafte</div>
        <div class="fc" data-bf="unpaid" onclick="setBF(this)">‚è≥ Unpaid</div>
        <div class="fc" data-bf="paid" onclick="setBF(this)">‚úÖ Paid</div>
      </div>
      <div id="billsList"></div>
      <div class="divider"></div>
      <div class="sh"><h2>üí≥ EMI / Loan Tracker</h2><span class="sa" onclick="openM('emiModal')">+ Add EMI</span></div>
      <div id="emiList"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê BUDGET ‚ïê‚ïê‚ïê -->
  <div id="pg-budget" class="page">
    <div class="pg">
      <div class="mnav">
        <button class="mbtn" onclick="chgBMonth(-1)">‚Äπ Pichla</button>
        <div class="mtit" id="budgetMonthTitle"></div>
        <button class="mbtn" onclick="chgBMonth(1)">Agla ‚Ä∫</button>
      </div>
      <div class="bhero">
        <div class="bhl">Monthly Budget Overview</div>
        <div class="bha" id="budgetTotal">‚Çπ0</div>
        <div class="bhs" id="budgetSub">Koi budget set nahi</div>
        <div class="bhrow">
          <div class="bhitem"><div class="bi">Kharca</div><div class="bv" id="budgetSpent">‚Çπ0</div></div>
          <div class="bhitem"><div class="bi">Baki</div><div class="bv" id="budgetLeft">‚Çπ0</div></div>
          <div class="bhitem"><div class="bi">Upyog</div><div class="bv" id="budgetPct">0%</div></div>
        </div>
      </div>
      <div class="card cp">
        <div class="sh"><h2>Category Budgets</h2><span class="sa" onclick="openM('budgetEditModal')">Edit Budgets</span></div>
        <div class="bclist" id="budgetCatList"></div>
      </div>
      <div class="ccard"><h3>üìä Budget vs Actual</h3><div class="cbox"><canvas id="budgetChart"></canvas></div></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê -->
  <div id="pg-settings" class="page">
    <div class="pg">
      <div class="sgt">Preferences</div>
      <div class="si" onclick="toggleTheme()">
        <div class="sico" style="background:rgba(139,127,255,.12)"><span class="material-icons-round" style="color:var(--purple)">palette</span></div>
        <div class="sinf"><h4>Dark / Light Mode</h4><p>App ka theme badlein</p></div>
        <button class="tgl" id="tglTheme" onclick="event.stopPropagation();toggleTheme()"></button>
      </div>

      <div class="sgt">Daily Spending Limit</div>
      <div class="si" onclick="tglLimit()">
        <div class="sico" style="background:var(--odim)"><span class="material-icons-round" style="color:var(--orange)">notifications_active</span></div>
        <div class="sinf"><h4>Daily Limit Alert</h4><p id="limitStTxt">Set nahi hua</p></div>
        <button class="tgl" id="tglLimit" onclick="event.stopPropagation();tglLimit()"></button>
      </div>
      <div class="lform" id="limitForm" style="display:none">
        <label class="fl">Daily Limit (‚Çπ)</label>
        <div class="linrow">
          <input class="linp" id="limitInp" type="number" min="1" placeholder="e.g. 500">
          <button class="svbtn" onclick="saveLimit()">Save</button>
        </div>
      </div>

      <div class="sgt">Security</div>
      <div class="si" onclick="openM('pinModal')">
        <div class="sico" style="background:var(--rdim)"><span class="material-icons-round" style="color:var(--red)">fingerprint</span></div>
        <div class="sinf"><h4>Fingerprint / PIN Lock</h4><p id="pinStTxt">Disabled</p></div>
        <button class="tgl" id="tglPin" onclick="event.stopPropagation();openM('pinModal')"></button>
      </div>

      <div class="sgt">Savings Goals</div>
      <div id="goalsList"></div>
      <button class="agbtn" onclick="openM('goalModal')"><span class="material-icons-round">add_circle_outline</span>New Goal Add Karein</button>

      <div class="sgt" style="margin-top:14px">Data Management</div>
      <div class="si" onclick="clearAllData()">
        <div class="sico" style="background:var(--rdim)"><span class="material-icons-round" style="color:var(--red)">delete_forever</span></div>
        <div class="sinf"><h4>Sab Data Delete Karein</h4><p>Permanently remove karta hai</p></div>
        <span class="material-icons-round" style="color:var(--txt3);font-size:18px">chevron_right</span>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <nav class="bnav">
    <button class="nbtn on" id="nb-dash" onclick="switchPg('dash')">
      <div class="niw"><span class="material-icons-round">home</span></div>Home
    </button>
    <button class="nbtn" id="nb-history" onclick="switchPg('history')">
      <div class="niw"><span class="material-icons-round">history</span></div>History
    </button>
    <button class="nbtn" id="nb-bills" onclick="switchPg('bills')">
      <div class="niw"><span class="material-icons-round">event_note</span></div>Bills
      <div class="rdot" id="billsDot"></div>
    </button>
    <button class="nbtn" id="nb-budget" onclick="switchPg('budget')">
      <div class="niw"><span class="material-icons-round">account_balance_wallet</span></div>Budget
    </button>
    <button class="nbtn" id="nb-settings" onclick="switchPg('settings')">
      <div class="niw"><span class="material-icons-round">tune</span></div>Settings
    </button>
  </nav>
</div>

<!-- FAB -->
<button class="fab" onclick="openM('addModal')"><span class="material-icons-round">add</span></button>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- ADD / EDIT TRANSACTION -->
<div class="ov" id="addModal">
  <div class="modal">
    <div class="mhdl"></div>
    <div class="mhdr">
      <h2 id="addMTitle">Transaction Add Karein</h2>
      <button class="mcls" onclick="closeM('addModal')"><span class="material-icons-round">close</span></button>
    </div>
    <div class="mbody">
      <div class="tg">
        <button class="tbtn ae" id="ttExp" onclick="setType('expense')"><span class="material-icons-round">arrow_upward</span>Kharcha</button>
        <button class="tbtn" id="ttInc" onclick="setType('income')"><span class="material-icons-round">arrow_downward</span>Amdani</button>
      </div>
      <div class="fg">
        <div class="awrap"><span class="apfx">‚Çπ</span><input class="afi" id="amtInp" type="number" inputmode="decimal" min="0" placeholder="0"></div>
      </div>
      <div class="fg"><label class="fl">Category</label><div class="cwrap" id="catChips"></div></div>
      <div class="fr">
        <div class="fg"><label class="fl">Tarikh</label><input type="date" class="fi" id="dateInp"></div>
        <div class="fg"><label class="fl">Samay</label><input type="time" class="fi" id="timeInp"></div>
      </div>
      <div class="fg" id="payGrp">
        <label class="fl">Payment Method</label>
        <div class="pwrap">
          <div class="pc sel" data-p="Cash" onclick="selPay(this)">üíµ Cash</div>
          <div class="pc" data-p="UPI" onclick="selPay(this)">üì± UPI</div>
          <div class="pc" data-p="Card" onclick="selPay(this)">üí≥ Card</div>
        </div>
      </div>
      <div class="fg"><label class="fl">Note (optional)</label><textarea class="fta" id="noteInp" placeholder="Kisliye kharch kiya?"></textarea></div>
      <button class="sbtn" onclick="submitTxn()"><span id="subBtnTxt">Kharcha Add Karein</span></button>
      <div class="mb"></div>
    </div>
  </div>
</div>

<!-- PIN / FINGERPRINT SETTINGS -->
<div class="ov" id="pinModal">
  <div class="modal">
    <div class="mhdl"></div>
    <div class="mhdr"><h2>App Lock</h2><button class="mcls" onclick="closeM('pinModal')"><span class="material-icons-round">close</span></button></div>
    <div class="mbody">
      <div style="background:var(--pdim);border:1px solid var(--purple);border-radius:12px;padding:12px;margin-bottom:14px;display:flex;align-items:center;gap:10px">
        <span class="material-icons-round" style="color:var(--purple);font-size:22px">fingerprint</span>
        <div><div style="font-size:13px;font-weight:700">Fingerprint / Face ID</div><div style="font-size:11px;color:var(--txt3);margin-top:2px" id="fpSupTxt">Check ho raha hai...</div></div>
      </div>
      <div class="fg"><label class="fl">Naya 4-Digit PIN</label><input type="password" class="fi" id="pinA" maxlength="4" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
      <div class="fg"><label class="fl">PIN Confirm Karein</label><input type="password" class="fi" id="pinB" maxlength="4" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
      <button class="sbtn" onclick="savePin()">Lock Enable Karein</button>
      <div id="disablePinDiv" style="display:none;margin-top:10px"><button class="sbtn dng" onclick="disablePin()">Lock Disable Karein</button></div>
      <div class="mb"></div>
    </div>
  </div>
</div>

<!-- GOAL MODAL -->
<div class="ov" id="goalModal">
  <div class="modal">
    <div class="mhdl"></div>
    <div class="mhdr"><h2>Savings Goal Add Karein</h2><button class="mcls" onclick="closeM('goalModal')"><span class="material-icons-round">close</span></button></div>
    <div class="mbody">
      <div class="fg"><label class="fl">Goal ka Naam</label><input class="fi" id="gNameInp" placeholder="e.g. iPhone, Vacation, Bike"></div>
      <div class="fg"><label class="fl">Target Amount (‚Çπ)</label><input type="number" class="fi" id="gTargetInp" placeholder="50000"></div>
      <div class="fg"><label class="fl">Abhi Tak Bachaya (‚Çπ)</label><input type="number" class="fi" id="gSavedInp" placeholder="0"></div>
      <button class="sbtn" onclick="saveGoal()">Goal Add Karein</button>
      <div class="mb"></div>
    </div>
  </div>
</div>

<!-- BILL MODAL -->
<div class="ov" id="billModal">
  <div class="modal">
    <div class="mhdl"></div>
    <div class="mhdr"><h2 id="billMTitle">Bill Reminder Add Karein</h2><button class="mcls" onclick="closeM('billModal')"><span class="material-icons-round">close</span></button></div>
    <div class="mbody">
      <div class="fg"><label class="fl">Bill ka Naam</label><input class="fi" id="bNameInp" placeholder="e.g. Electricity, Netflix, WiFi"></div>
      <div class="fg"><label class="fl">Amount (‚Çπ)</label><input type="number" class="fi" id="bAmtInp" placeholder="500"></div>
      <div class="fr">
        <div class="fg"><label class="fl">Due Date</label><input type="date" class="fi" id="bDueInp"></div>
        <div class="fg"><label class="fl">Category</label>
          <select class="fs" id="bCatInp">
            <option value="bills">Bills</option><option value="recharge">Recharge</option>
            <option value="rent">Rent</option><option value="food">Food</option>
            <option value="shopping">Shopping</option><option value="other">Other</option>
          </select>
        </div>
      </div>
      <div class="fg"><label class="fl">Repeat</label>
        <select class="fs" id="bRepeatInp">
          <option value="none">Ek Baar</option><option value="monthly">Har Mahine</option>
          <option value="weekly">Har Hafte</option><option value="yearly">Har Saal</option>
        </select>
      </div>
      <div class="fg"><label class="fl">Note (optional)</label><input class="fi" id="bNoteInp" placeholder="Account number, provider..."></div>
      <button class="sbtn" id="billSubmitBtn" onclick="saveBill()">Bill Reminder Add Karein</button>
      <div class="mb"></div>
    </div>
  </div>
</div>

<!-- EMI MODAL -->
<div class="ov" id="emiModal">
  <div class="modal">
    <div class="mhdl"></div>
    <div class="mhdr"><h2 id="emiMTitle">EMI / Loan Add Karein</h2><button class="mcls" onclick="closeM('emiModal')"><span class="material-icons-round">close</span></button></div>
    <div class="mbody">
      <div class="fg"><label class="fl">Loan / EMI ka Naam</label><input class="fi" id="eNameInp" placeholder="e.g. Home Loan, Car EMI"></div>
      <div class="fg"><label class="fl">Bank / Lender</label><input class="fi" id="eBankInp" placeholder="e.g. SBI, HDFC, ICICI"></div>
      <div class="fr">
        <div class="fg"><label class="fl">Total Amount (‚Çπ)</label><input type="number" class="fi" id="eTotalInp" placeholder="500000"></div>
        <div class="fg"><label class="fl">EMI/Month (‚Çπ)</label><input type="number" class="fi" id="eEmiInp" placeholder="15000"></div>
      </div>
      <div class="fr">
        <div class="fg"><label class="fl">Kul EMIs</label><input type="number" class="fi" id="eTotalEmiInp" placeholder="48"></div>
        <div class="fg"><label class="fl">EMIs Paid</label><input type="number" class="fi" id="ePaidInp" placeholder="12"></div>
      </div>
      <div class="fr">
        <div class="fg"><label class="fl">Start Date</label><input type="date" class="fi" id="eStartInp"></div>
        <div class="fg"><label class="fl">Due Day (1-28)</label><input type="number" class="fi" id="eDayInp" min="1" max="28" placeholder="5"></div>
      </div>
      <div class="fg"><label class="fl">Interest Rate (% p.a.)</label><input type="number" class="fi" id="eRateInp" placeholder="8.5" step="0.1"></div>
      <button class="sbtn" id="emiSubmitBtn" onclick="saveEmi()">EMI Add Karein</button>
      <div class="mb"></div>
    </div>
  </div>
</div>

<!-- WHATSAPP SHARE MODAL -->
<div class="ov" id="waModal">
  <div class="modal">
    <div class="mhdl"></div>
    <div class="mhdr"><h2>WhatsApp Share</h2><button class="mcls" onclick="closeM('waModal')"><span class="material-icons-round">close</span></button></div>
    <div class="mbody">
      <div class="fg">
        <label class="fl">Share Type</label>
        <div class="cwrap">
          <div class="cc sel" data-wt="single" onclick="setWaType(this)">Single Entry</div>
          <div class="cc" data-wt="today" onclick="setWaType(this)">Aaj ka Summary</div>
          <div class="cc" data-wt="month" onclick="setWaType(this)">Month Report</div>
        </div>
      </div>
      <div class="wabox"><div class="wahdr">Message Preview</div><div class="wamsg" id="waPreview"></div></div>
      <button class="sbtn grn" onclick="doWaShare()"><span class="material-icons-round" style="vertical-align:middle;font-size:18px;margin-right:5px">send</span>WhatsApp pe Share Karein</button>
      <div class="mb"></div>
    </div>
  </div>
</div>

<!-- BUDGET EDIT MODAL -->
<div class="ov" id="budgetEditModal">
  <div class="modal">
    <div class="mhdl"></div>
    <div class="mhdr"><h2>Category Budgets Set Karein</h2><button class="mcls" onclick="closeM('budgetEditModal')"><span class="material-icons-round">close</span></button></div>
    <div class="mbody">
      <div style="font-size:12px;color:var(--txt3);margin-bottom:13px">Har category ke liye monthly budget set karein (0 = koi limit nahi)</div>
      <div id="budgetInpsList"></div>
      <button class="sbtn" onclick="saveBudgets()">Budgets Save Karein</button>
      <div class="mb"></div>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONSTANTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ECATS=[
  {id:'food',    n:'Food',     ico:'restaurant',     c:'#ff5f7e'},
  {id:'travel',  n:'Travel',   ico:'directions_car', c:'#ffaa4d'},
  {id:'shopping',n:'Shopping', ico:'shopping_bag',   c:'#c084fc'},
  {id:'bills',   n:'Bills',    ico:'receipt_long',   c:'#4db8ff'},
  {id:'recharge',n:'Recharge', ico:'smartphone',     c:'#4dffb8'},
  {id:'rent',    n:'Rent',     ico:'home',           c:'#fb923c'},
  {id:'health',  n:'Health',   ico:'favorite',       c:'#f472b6'},
  {id:'other',   n:'Other',    ico:'more_horiz',     c:'#818cf8'},
];
const ICATS=[
  {id:'salary',    n:'Salary',    ico:'work',         c:'#4dffb8'},
  {id:'freelance', n:'Freelance', ico:'laptop_mac',   c:'#4db8ff'},
  {id:'business',  n:'Business',  ico:'store',        c:'#ffaa4d'},
  {id:'investment',n:'Invest',    ico:'trending_up',  c:'#8b7fff'},
  {id:'gift',      n:'Gift',      ico:'card_giftcard',c:'#f472b6'},
  {id:'other_inc', n:'Other',     ico:'more_horiz',   c:'#818cf8'},
];
const BICO={bills:'receipt_long',recharge:'smartphone',rent:'home',food:'restaurant',shopping:'shopping_bag',other:'payments'};
const ECLRS=['#8b7fff','#4db8ff','#4dffb8','#ff5f7e','#ffaa4d','#f472b6','#fb923c','#2dd4bf'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let DS={txns:[],goals:[],bills:[],emis:[],settings:{theme:'dark',limitEnabled:false,dailyLimit:0,pinEnabled:false,pin:''},budgets:{}};
let curType='expense', selCat='food', selPayM='Cash', editId=null;
let rMonth=new Date().getMonth(), rYear=new Date().getFullYear();
let bMonth=new Date().getMonth(), bYear=new Date().getFullYear();
let editBillId=null, editEmiId=null;
let barC=null, pieC=null, lineC=null, budgetC=null;
let deferredPrompt=null, pinBuf='';
let waType='single', waTxnId=null;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function load(){
  try{
    const t=localStorage.getItem('mk_txns'), g=localStorage.getItem('mk_goals'),
          s=localStorage.getItem('mk_settings'), b=localStorage.getItem('mk_bills'),
          e=localStorage.getItem('mk_emis'), bg=localStorage.getItem('mk_budgets');
    if(t) DS.txns=JSON.parse(t);
    if(g) DS.goals=JSON.parse(g);
    if(s) DS.settings=Object.assign({},DS.settings,JSON.parse(s));
    if(b) DS.bills=JSON.parse(b);
    if(e) DS.emis=JSON.parse(e);
    if(bg) DS.budgets=JSON.parse(bg);
  }catch(e){console.warn('Load error',e);}
}
const sT=()=>localStorage.setItem('mk_txns',JSON.stringify(DS.txns));
const sG=()=>localStorage.setItem('mk_goals',JSON.stringify(DS.goals));
const sS=()=>localStorage.setItem('mk_settings',JSON.stringify(DS.settings));
const sB=()=>localStorage.setItem('mk_bills',JSON.stringify(DS.bills));
const sE=()=>localStorage.setItem('mk_emis',JSON.stringify(DS.emis));
const sBg=()=>localStorage.setItem('mk_budgets',JSON.stringify(DS.budgets));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PWA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function injectManifest(){
  const m={name:'MyKharcha ‚Äì Smart Expense Tracker',short_name:'MyKharcha',description:'Smart Expense Tracker',start_url:'./',display:'standalone',background_color:'#0c0c1a',theme_color:'#0c0c1a',orientation:'portrait',icons:[{src:mkIco(192),sizes:'192x192',type:'image/png',purpose:'any maskable'},{src:mkIco(512),sizes:'512x512',type:'image/png',purpose:'any maskable'}]};
  const blob=new Blob([JSON.stringify(m)],{type:'application/manifest+json'});
  document.getElementById('manifestLink').href=URL.createObjectURL(blob);
}
function mkIco(sz){
  const c=document.createElement('canvas');c.width=c.height=sz;
  const ctx=c.getContext('2d');
  ctx.fillStyle='#0c0c1a';ctx.beginPath();ctx.roundRect(0,0,sz,sz,sz*.22);ctx.fill();
  const g=ctx.createLinearGradient(sz*.1,sz*.1,sz*.9,sz*.9);g.addColorStop(0,'#8b7fff');g.addColorStop(1,'#4db8ff');
  ctx.fillStyle=g;ctx.font=`bold ${sz*.55}px system-ui`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('‚Çπ',sz/2,sz/2);
  return c.toDataURL('image/png');
}
function regSW(){
  if(!('serviceWorker' in navigator))return;
  const sw=`const C='mk-v3';self.addEventListener('install',e=>{self.skipWaiting();});self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(k=>Promise.all(k.filter(x=>x!==C).map(x=>caches.delete(x)))));self.clients.claim();});self.addEventListener('fetch',e=>{if(e.request.method!=='GET')return;e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));});`;
  navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw],{type:'text/javascript'}))).catch(()=>{});
}
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;document.getElementById('installBanner').style.display='flex';});
function doInstall(){if(!deferredPrompt)return;deferredPrompt.prompt();deferredPrompt.userChoice.then(()=>{deferredPrompt=null;document.getElementById('installBanner').style.display='none';});}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  THEME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleTheme(){
  const isL=document.documentElement.getAttribute('data-theme')==='light';
  applyTheme(isL?'dark':'light');
}
function applyTheme(t){
  t=t||DS.settings.theme||'dark';
  document.documentElement.setAttribute('data-theme',t);
  DS.settings.theme=t; sS();
  const isL=t==='light';
  document.getElementById('thIco').textContent=isL?'dark_mode':'light_mode';
  document.getElementById('tglTheme').classList.toggle('on',isL);
  document.getElementById('metaTheme').content=isL?'#f0f0f8':'#0c0c1a';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PAGE NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchPg(pg){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nbtn').forEach(b=>b.classList.remove('on'));
  document.getElementById('pg-'+pg).classList.add('active');
  const nb=document.getElementById('nb-'+pg);
  if(nb) nb.classList.add('on');
  window.scrollTo(0,0);
  if(pg==='dash')    renderDash();
  if(pg==='history') renderHistory();
  if(pg==='reports') renderReports();
  if(pg==='bills')   renderBills();
  if(pg==='budget')  renderBudget();
  if(pg==='settings')renderSettings();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openM(id){
  if(id==='addModal'){resetForm();}
  if(id==='pinModal'){
    document.getElementById('disablePinDiv').style.display=DS.settings.pinEnabled?'':'none';
    document.getElementById('pinA').value='';document.getElementById('pinB').value='';
    checkFPSupport();
  }
  if(id==='billModal' && !editBillId){
    // reset bill form
    document.getElementById('billMTitle').textContent='Bill Reminder Add Karein';
    document.getElementById('billSubmitBtn').textContent='Bill Reminder Add Karein';
    document.getElementById('bNameInp').value='';document.getElementById('bAmtInp').value='';
    document.getElementById('bDueInp').value=toDS(new Date());document.getElementById('bNoteInp').value='';
    document.getElementById('bCatInp').value='bills';document.getElementById('bRepeatInp').value='none';
  }
  if(id==='emiModal' && !editEmiId){
    document.getElementById('emiMTitle').textContent='EMI / Loan Add Karein';
    document.getElementById('emiSubmitBtn').textContent='EMI Add Karein';
    ['eNameInp','eBankInp','eTotalInp','eEmiInp','eTotalEmiInp','ePaidInp','eRateInp','eDayInp'].forEach(x=>document.getElementById(x).value='');
    document.getElementById('eStartInp').value=toDS(new Date());
  }
  if(id==='budgetEditModal') buildBudgetInps();
  document.getElementById(id).classList.add('open');
  document.body.style.overflow='hidden';
}
function closeM(id){
  document.getElementById(id).classList.remove('open');
  document.body.style.overflow='';
  if(id==='billModal') editBillId=null;
  if(id==='emiModal') editEmiId=null;
}
// close on overlay click
document.addEventListener('click',function(e){
  if(e.target.classList.contains('ov')) closeM(e.target.id);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TRANSACTION FORM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function resetForm(){
  editId=null;
  document.getElementById('addMTitle').textContent='Transaction Add Karein';
  document.getElementById('subBtnTxt').textContent='Kharcha Add Karein';
  document.getElementById('amtInp').value='';
  document.getElementById('noteInp').value='';
  const now=new Date();
  document.getElementById('dateInp').value=toDS(now);
  document.getElementById('timeInp').value=now.toTimeString().slice(0,5);
  selCat='food'; selPayM='Cash'; curType='expense';
  setType('expense');
  document.querySelectorAll('.pc').forEach(c=>c.classList.toggle('sel',c.dataset.p==='Cash'));
}
function setType(t){
  curType=t;
  document.getElementById('ttExp').className='tbtn'+(t==='expense'?' ae':'');
  document.getElementById('ttInc').className='tbtn'+(t==='income'?' ai':'');
  document.getElementById('payGrp').style.display=t==='expense'?'':'none';
  selCat=t==='expense'?'food':'salary';
  if(!editId) document.getElementById('subBtnTxt').textContent=t==='expense'?'Kharcha Add Karein':'Amdani Add Karein';
  buildCatChips();
}
function buildCatChips(){
  const cats=curType==='expense'?ECATS:ICATS;
  document.getElementById('catChips').innerHTML=cats.map(c=>
    `<div class="cc${c.id===selCat?' sel':''}" onclick="pickCat('${c.id}')"><span class="material-icons-round" style="color:${c.c}">${c.ico}</span>${c.n}</div>`
  ).join('');
}
function pickCat(id){selCat=id;buildCatChips();}
function selPay(el){document.querySelectorAll('.pc').forEach(c=>c.classList.remove('sel'));el.classList.add('sel');selPayM=el.dataset.p;}

function submitTxn(){
  const amt=parseFloat(document.getElementById('amtInp').value);
  if(!amt||amt<=0){toast('Valid amount darj karein','err');return;}
  const d=document.getElementById('dateInp').value;
  const ti=document.getElementById('timeInp').value;
  if(!d){toast('Tarikh select karein','err');return;}
  const txn={
    id:editId||Date.now().toString(),
    type:curType, amount:amt, cat:selCat,
    date:d, time:ti,
    note:document.getElementById('noteInp').value.trim(),
    pay:curType==='expense'?selPayM:'N/A'
  };
  if(editId){
    const i=DS.txns.findIndex(t=>t.id===editId);
    if(i>-1) DS.txns[i]=txn;
    toast('Transaction update hua! ‚úì','ok');
  } else {
    DS.txns.unshift(txn);
    toast((curType==='expense'?'Kharcha':'Amdani')+' add hua! ‚úì','ok');
    chkLimit(txn);
  }
  sT();closeM('addModal');renderDash();
  if(document.getElementById('pg-history').classList.contains('active')) renderHistory();
}
function editTxn(id){
  const t=DS.txns.find(x=>x.id===id);if(!t)return;
  editId=id;
  setType(t.type);
  document.getElementById('amtInp').value=t.amount;
  document.getElementById('dateInp').value=t.date;
  document.getElementById('timeInp').value=t.time;
  document.getElementById('noteInp').value=t.note||'';
  selCat=t.cat; selPayM=t.pay||'Cash';
  buildCatChips();
  document.querySelectorAll('.pc').forEach(c=>c.classList.toggle('sel',c.dataset.p===selPayM));
  document.getElementById('addMTitle').textContent='Transaction Edit Karein';
  document.getElementById('subBtnTxt').textContent='Update Karein';
  openM('addModal');
}
function delTxn(id){
  if(!confirm('Is transaction ko delete karein?'))return;
  DS.txns=DS.txns.filter(t=>t.id!==id);
  sT();renderDash();
  if(document.getElementById('pg-history').classList.contains('active')) renderHistory();
  toast('Delete hua ‚úì','err');
}
function chkLimit(txn){
  if(!DS.settings.limitEnabled||!DS.settings.dailyLimit||txn.type!=='expense')return;
  const spent=DS.txns.filter(t=>t.type==='expense'&&t.date===toDS(new Date())).reduce((s,t)=>s+t.amount,0);
  if(spent>DS.settings.dailyLimit) toast(`‚ö†Ô∏è Daily limit ‚Çπ${rfmt(DS.settings.dailyLimit)} exceed!`,'warn');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDash(){
  const today=toDS(new Date()), now=new Date(), cm=now.getMonth(), cy=now.getFullYear();
  const tE=DS.txns.filter(t=>t.type==='expense'&&t.date===today);
  const mE=DS.txns.filter(t=>t.type==='expense'&&smth(t.date,cm,cy));
  const mI=DS.txns.filter(t=>t.type==='income'&&smth(t.date,cm,cy));
  const tT=sm(tE), mT=sm(mE), iT=sm(mI), bal=iT-mT;
  qs('#heroAmt').textContent=r(Math.abs(bal));
  qs('#heroSub').textContent=bal>=0?'‚ñ≤ Is mahine ka surplus':'‚ñº Is mahine ka deficit';
  qs('#todayAmt').textContent=r(tT);
  qs('#monthAmt').textContent=r(mT);
  qs('#txnCnt').textContent=mE.length+mI.length;
  qs('#incAmt').textContent=r(iT);
  qs('#savAmt').textContent=r(Math.max(0,bal));
  // Limit bar
  const ls=DS.settings;
  if(ls.limitEnabled&&ls.dailyLimit){
    const pct=Math.min(100,(tT/ls.dailyLimit)*100);
    qs('#lstrip').style.display='';
    qs('#lfill').style.width=pct+'%';
    qs('#lfill').classList.toggle('over',pct>=100);
    qs('#ltxt').textContent=`${r(tT)} / ${r(ls.dailyLimit)}`;
  } else qs('#lstrip').style.display='none';
  // Categories
  const ct={};ECATS.forEach(c=>{ct[c.id]=0;});
  mE.forEach(t=>{if(ct[t.cat]!==undefined) ct[t.cat]+=t.amount;});
  const sorted=ECATS.filter(c=>ct[c.id]>0).sort((a,b)=>ct[b.id]-ct[a.id]);
  const cs=qs('#catSummary');
  cs.innerHTML=sorted.length?sorted.slice(0,6).map(c=>{
    const pct=mT>0?((ct[c.id]/mT)*100).toFixed(0):0;
    return`<div class="crow"><div class="ci" style="background:${c.c}18"><span class="material-icons-round" style="color:${c.c}">${c.ico}</span></div><div class="cm"><div class="cn">${c.n}</div><div class="cpbar"><div class="cpfill" style="width:${pct}%;background:${c.c}"></div></div></div><div class="cp2">${pct}%</div><div class="ca" style="color:${c.c}">${r(ct[c.id])}</div></div>`;
  }).join(''):'<div class="empty"><span class="material-icons-round">pie_chart</span><p>Is mahine koi kharcha nahi</p></div>';
  // Recent
  const rt=qs('#recentTxns');
  const rec=DS.txns.slice(0,5);
  rt.innerHTML=rec.length?rec.map(t=>txnRow(t,false)).join(''):`<div class="empty"><span class="material-icons-round">receipt_long</span><h3>Koi transaction nahi</h3><p>+ dabao pehla kharcha add karne ke liye</p></div>`;
  // Dashboard bills
  const due=DS.bills.filter(b=>!b.paid&&dUntil(b.dueDate)<=3).sort((a,b)=>dUntil(a.dueDate)-dUntil(b.dueDate)).slice(0,3);
  const dbw=qs('#dashBillsWrap');
  if(due.length){dbw.style.display='';qs('#dashBillsList').innerHTML=due.map(b=>billRow(b,false)).join('');}
  else dbw.style.display='none';
  updNotif();
}

function txnRow(t,acts){
  const cats=t.type==='expense'?ECATS:ICATS;
  const cat=cats.find(c=>c.id===t.cat)||{n:t.cat,ico:'paid',c:'#888'};
  const pt=t.type==='expense'?`<span class="tag ${(t.pay||'').toLowerCase()}">${t.pay||''}</span>`:`<span class="tag income-tag">Amdani</span>`;
  const ab=acts?`<div class="tacts">
    <button class="tabtn ed" onclick="event.stopPropagation();editTxn('${t.id}')" title="Edit"><span class="material-icons-round">edit</span></button>
    <button class="tabtn wa" onclick="event.stopPropagation();openWa('${t.id}')" title="WhatsApp Share"><span class="material-icons-round">share</span></button>
    <button class="tabtn dl" onclick="event.stopPropagation();delTxn('${t.id}')" title="Delete"><span class="material-icons-round">delete</span></button>
  </div>`:'';
  return`<div class="txn ${t.type==='expense'?'ex':'in'}">
    <div class="tico" style="background:${cat.c}18"><span class="material-icons-round" style="color:${cat.c}">${cat.ico}</span></div>
    <div class="tbody">
      <div class="tc">${cat.n} ${pt}</div>
      <div class="tn">${t.note||'Note nahi'}</div>
      <div class="tt">${fmtDate(t.date)} ¬∑ ${t.time||''}</div>
    </div>
    <div class="tright">
      <div class="tamt ${t.type==='expense'?'ex':'in'}">${t.type==='expense'?'-':'+'}${r(t.amount)}</div>
      ${ab}
    </div>
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HISTORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHistory(){
  const fr=qs('#catFilters');
  if(!fr.children.length){
    fr.innerHTML=`<div class="fc on" data-c="all" onclick="setCF(this)">Sab</div>`
      +ECATS.map(c=>`<div class="fc" data-c="${c.id}" onclick="setCF(this)">${c.n}</div>`).join('')
      +ICATS.map(c=>`<div class="fc" data-c="${c.id}" onclick="setCF(this)">${c.n}</div>`).join('');
  }
  const ac=(qs('#catFilters .fc.on')||{dataset:{c:'all'}}).dataset.c;
  const sq=(qs('#searchInp').value||'').toLowerCase();
  const fd=qs('#dateFilter').value;
  let txns=[...DS.txns];
  if(ac!=='all') txns=txns.filter(t=>t.cat===ac);
  if(sq) txns=txns.filter(t=>(t.note||'').toLowerCase().includes(sq)||(t.cat||'').toLowerCase().includes(sq));
  if(fd) txns=txns.filter(t=>t.date===fd);
  const hc=qs('#histContent');
  if(!txns.length){hc.innerHTML=`<div class="empty"><span class="material-icons-round">search_off</span><h3>Kuch nahi mila</h3><p>Alag filter try karein</p></div>`;return;}
  const grps={};
  txns.forEach(t=>{(grps[t.date]=grps[t.date]||[]).push(t);});
  const days=Object.keys(grps).sort((a,b)=>new Date(b)-new Date(a));
  hc.innerHTML=days.map(d=>{
    const items=grps[d];
    const dt=items.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);
    return`<div class="dgrp"><div class="dlbl"><span class="dl">${fmtDate(d)}</span><span class="dr">-${r(dt)}</span></div><div class="tlist">${items.map(t=>txnRow(t,true)).join('')}</div></div>`;
  }).join('');
}
function setCF(el){qs('#catFilters .fc.on').classList.remove('on');el.classList.add('on');renderHistory();}
function clearDateFilter(){qs('#dateFilter').value='';renderHistory();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  REPORTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReports(){
  qs('#rMonthTitle').textContent=new Date(rYear,rMonth).toLocaleDateString('en-IN',{month:'long',year:'numeric'});
  buildBar();buildPie();buildLine();
}
function chgMonth(d){rMonth+=d;if(rMonth<0){rMonth=11;rYear--;}if(rMonth>11){rMonth=0;rYear++;}renderReports();}
const cO=()=>({g:document.documentElement.getAttribute('data-theme')==='light'?'rgba(0,0,0,.06)':'rgba(255,255,255,.06)',t:document.documentElement.getAttribute('data-theme')==='light'?'#555':'#888aaa'});

function buildBar(){
  if(barC){barC.destroy();barC=null;}
  const labels=[],data=[];
  for(let i=5;i>=0;i--){let m=rMonth-i,y=rYear;if(m<0){m+=12;y--;}labels.push(new Date(y,m).toLocaleDateString('en-IN',{month:'short'}));data.push(DS.txns.filter(t=>t.type==='expense'&&smth(t.date,m,y)).reduce((s,t)=>s+t.amount,0));}
  const o=cO();
  barC=new Chart(qs('#barChart'),{type:'bar',data:{labels,datasets:[{data,backgroundColor:'rgba(139,127,255,.75)',borderRadius:8,borderSkipped:false}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{grid:{color:o.g},ticks:{color:o.t}},y:{grid:{color:o.g},ticks:{color:o.t,callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}});
}
function buildPie(){
  if(pieC){pieC.destroy();pieC=null;}
  const lbs=[],data=[],clrs=[];
  ECATS.forEach(c=>{const tot=DS.txns.filter(t=>t.type==='expense'&&smth(t.date,rMonth,rYear)&&t.cat===c.id).reduce((s,t)=>s+t.amount,0);if(tot>0){lbs.push(c.n);data.push(tot);clrs.push(c.c);}});
  if(!data.length){lbs.push('Koi Data Nahi');data.push(1);clrs.push('#333');}
  const o=cO();
  pieC=new Chart(qs('#pieChart'),{type:'doughnut',data:{labels:lbs,datasets:[{data,backgroundColor:clrs,borderWidth:0,hoverOffset:8}]},options:{responsive:true,maintainAspectRatio:false,cutout:'60%',plugins:{legend:{position:'bottom',labels:{color:o.t,padding:10,font:{size:10}}}}}});
}
function buildLine(){
  if(lineC){lineC.destroy();lineC=null;}
  const days=new Date(rYear,rMonth+1,0).getDate();
  const lbs=[],data=[];
  for(let d=1;d<=days;d++){const ds=`${rYear}-${String(rMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;lbs.push(d);data.push(DS.txns.filter(t=>t.type==='expense'&&t.date===ds).reduce((s,t)=>s+t.amount,0));}
  const o=cO();
  lineC=new Chart(qs('#lineChart'),{type:'line',data:{labels:lbs,datasets:[{data,borderColor:'#4db8ff',backgroundColor:'rgba(77,184,255,.1)',tension:.4,fill:true,pointRadius:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{grid:{color:o.g},ticks:{color:o.t}},y:{grid:{color:o.g},ticks:{color:o.t,callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BILLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function dUntil(ds){const d=new Date(ds+'T00:00:00');const t=new Date();t.setHours(0,0,0,0);return Math.ceil((d-t)/86400000);}

function billRow(b,acts){
  const days=dUntil(b.dueDate);
  const cat=ECATS.find(c=>c.id===b.cat)||{c:'#818cf8'};
  const ico=BICO[b.cat]||'payments';
  let sc='ok',st='Aane wala',cc='uc';
  if(b.paid){sc='pd';st='Paid';cc='';}
  else if(days<0){sc='tod';st=`${Math.abs(days)}d overdue`;cc='dt';}
  else if(days===0){sc='tod';st='Aaj Due';cc='dt';}
  else if(days<=3){sc='sn';st=`${days}d baki`;cc='ds';}
  else st=`${days}d baki`;
  const ab=acts?`<div class="bacts">
    ${!b.paid?`<button class="tabtn" style="color:var(--green);border-color:var(--green)" onclick="markPaid('${b.id}')" title="Paid mark karein"><span class="material-icons-round" style="font-size:13px">check</span></button>`:''}
    <button class="tabtn ed" onclick="editBill('${b.id}')" title="Edit"><span class="material-icons-round">edit</span></button>
    <button class="tabtn dl" onclick="delBill('${b.id}')" title="Delete"><span class="material-icons-round">delete</span></button>
  </div>`:'';
  return`<div class="bcard ${cc}">
    <div class="bico" style="background:${cat.c}18"><span class="material-icons-round" style="color:${cat.c}">${ico}</span></div>
    <div class="binfo">
      <div class="bn">${b.name}</div>
      <div class="bd">${b.repeat!=='none'?'üîÑ '+{monthly:'Har Mahine',weekly:'Har Hafte',yearly:'Har Saal'}[b.repeat]+' ¬∑ ':''} Due: ${b.dueDate}</div>
      ${b.note?`<div class="bd">${b.note}</div>`:''}
    </div>
    <div class="bright">
      <div class="bamt" style="color:${cat.c}">${r(b.amount)}</div>
      <div class="bst ${sc}">${st}</div>
      ${ab}
    </div>
  </div>`;
}

function saveBill(){
  const name=(qs('#bNameInp').value||'').trim();
  const amt=parseFloat(qs('#bAmtInp').value);
  const due=qs('#bDueInp').value;
  if(!name){toast('Bill ka naam darj karein','err');return;}
  if(!amt||amt<=0){toast('Valid amount darj karein','err');return;}
  if(!due){toast('Due date select karein','err');return;}
  const bill={
    id:editBillId||Date.now().toString(),
    name, amount:amt, dueDate:due,
    cat:qs('#bCatInp').value,
    repeat:qs('#bRepeatInp').value,
    note:(qs('#bNoteInp').value||'').trim(),
    paid:false
  };
  if(editBillId){
    const i=DS.bills.findIndex(b=>b.id===editBillId);
    if(i>-1) DS.bills[i]={...DS.bills[i],...bill};
    toast('Bill update hua! ‚úì','ok');
  } else {
    DS.bills.push(bill);
    toast('Bill reminder add hua! ‚úì','ok');
  }
  sB();closeM('billModal');renderBills();renderDash();
}
function editBill(id){
  const b=DS.bills.find(x=>x.id===id);if(!b)return;
  editBillId=id;
  qs('#billMTitle').textContent='Bill Edit Karein';
  qs('#billSubmitBtn').textContent='Bill Update Karein';
  qs('#bNameInp').value=b.name;qs('#bAmtInp').value=b.amount;
  qs('#bDueInp').value=b.dueDate;qs('#bCatInp').value=b.cat;
  qs('#bRepeatInp').value=b.repeat;qs('#bNoteInp').value=b.note||'';
  openM('billModal');
}
function delBill(id){
  if(!confirm('Bill delete karein?'))return;
  DS.bills=DS.bills.filter(b=>b.id!==id);
  sB();renderBills();renderDash();updNotif();toast('Bill delete hua','err');
}
function markPaid(id){
  const b=DS.bills.find(x=>x.id===id);if(!b)return;
  // Add as expense
  DS.txns.unshift({id:Date.now().toString(),type:'expense',amount:b.amount,cat:b.cat,date:toDS(new Date()),time:new Date().toTimeString().slice(0,5),note:'Bill paid: '+b.name,pay:'UPI'});
  sT();
  // Handle repeat
  if(b.repeat==='monthly'){const nd=new Date(b.dueDate);nd.setMonth(nd.getMonth()+1);b.dueDate=toDS(nd);}
  else if(b.repeat==='weekly'){const nd=new Date(b.dueDate);nd.setDate(nd.getDate()+7);b.dueDate=toDS(nd);}
  else if(b.repeat==='yearly'){const nd=new Date(b.dueDate);nd.setFullYear(nd.getFullYear()+1);b.dueDate=toDS(nd);}
  else b.paid=true;
  sB();renderBills();renderDash();updNotif();toast('Bill paid! Kharche mein add hua ‚úì','ok');
}
function setBF(el){qs('#billFilters .fc.on').classList.remove('on');el.classList.add('on');renderBills();}
function renderBills(){
  const af=(qs('#billFilters .fc.on')||{dataset:{bf:'all'}}).dataset.bf;
  let bills=[...DS.bills].sort((a,b)=>new Date(a.dueDate)-new Date(b.dueDate));
  if(af==='today') bills=bills.filter(b=>!b.paid&&dUntil(b.dueDate)<=0);
  else if(af==='week') bills=bills.filter(b=>!b.paid&&dUntil(b.dueDate)<=7&&dUntil(b.dueDate)>=0);
  else if(af==='paid') bills=bills.filter(b=>b.paid);
  else if(af==='unpaid') bills=bills.filter(b=>!b.paid);
  const bl=qs('#billsList');
  bl.innerHTML=bills.length?bills.map(b=>billRow(b,true)).join(''):`<div class="empty"><span class="material-icons-round">event_available</span><h3>Koi bill nahi</h3><p>+ Add Bill dabao</p></div>`;
  renderEmis();
  updNotif();
}
function updNotif(){
  const cnt=DS.bills.filter(b=>!b.paid&&dUntil(b.dueDate)<=1).length;
  qs('#notifDot').classList.toggle('on',cnt>0);
  qs('#billsDot').classList.toggle('on',cnt>0);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EMI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveEmi(){
  const name=(qs('#eNameInp').value||'').trim();
  const total=parseFloat(qs('#eTotalInp').value);
  const emi=parseFloat(qs('#eEmiInp').value);
  const totalE=parseInt(qs('#eTotalEmiInp').value);
  const paid=parseInt(qs('#ePaidInp').value)||0;
  if(!name){toast('EMI ka naam darj karein','err');return;}
  if(!total||!emi||!totalE){toast('Sabhi fields bharen','err');return;}
  const obj={id:editEmiId||Date.now().toString(),name,bank:(qs('#eBankInp').value||'').trim(),total,emi,totalEmis:totalE,paid,startDate:qs('#eStartInp').value,dueDay:parseInt(qs('#eDayInp').value)||5,rate:parseFloat(qs('#eRateInp').value)||0};
  if(editEmiId){const i=DS.emis.findIndex(e=>e.id===editEmiId);if(i>-1) DS.emis[i]=obj;toast('EMI update hua! ‚úì','ok');}
  else{DS.emis.push(obj);toast('EMI add hua! ‚úì','ok');}
  sE();closeM('emiModal');renderEmis();
}
function editEmiItem(id){
  const e=DS.emis.find(x=>x.id===id);if(!e)return;
  editEmiId=id;
  qs('#emiMTitle').textContent='EMI Edit Karein';
  qs('#emiSubmitBtn').textContent='EMI Update Karein';
  qs('#eNameInp').value=e.name;qs('#eBankInp').value=e.bank||'';
  qs('#eTotalInp').value=e.total;qs('#eEmiInp').value=e.emi;
  qs('#eTotalEmiInp').value=e.totalEmis;qs('#ePaidInp').value=e.paid;
  qs('#eStartInp').value=e.startDate;qs('#eDayInp').value=e.dueDay;
  qs('#eRateInp').value=e.rate;
  openM('emiModal');
}
function delEmi(id){
  if(!confirm('EMI delete karein?'))return;
  DS.emis=DS.emis.filter(e=>e.id!==id);sE();renderEmis();toast('EMI delete hua','err');
}
function renderEmis(){
  const el=qs('#emiList');
  if(!DS.emis.length){el.innerHTML=`<div class="empty"><span class="material-icons-round">credit_card</span><h3>Koi EMI nahi</h3><p>+ Add EMI dabao loan track karne ke liye</p></div>`;return;}
  el.innerHTML=DS.emis.map((e,idx)=>{
    const rem=e.totalEmis-e.paid, pct=Math.min(100,(e.paid/e.totalEmis)*100).toFixed(1);
    const remAmt=rem*e.emi, clr=ECLRS[idx%ECLRS.length];
    return`<div class="ecard">
      <div class="etop">
        <div class="eico" style="background:${clr}"><span class="material-icons-round">credit_card</span></div>
        <div class="etit">
          <div class="en">${e.name}${e.bank?' ¬∑ '+e.bank:''}</div>
          <div class="eb">Due day: ${e.dueDay} ¬∑ Rate: ${e.rate}% p.a.</div>
          <div class="ea">${r(e.emi)}/mahine</div>
        </div>
        <div style="display:flex;gap:3px">
          <button class="tabtn ed" onclick="editEmiItem('${e.id}')" title="Edit"><span class="material-icons-round">edit</span></button>
          <button class="tabtn dl" onclick="delEmi('${e.id}')" title="Delete"><span class="material-icons-round">delete</span></button>
        </div>
      </div>
      <div class="epbar"><div class="epfill" style="width:${pct}%;background:${clr}"></div></div>
      <div class="eplbl"><span>${e.paid}/${e.totalEmis} paid (${pct}%)</span><span>${rem} baki</span></div>
      <div class="etags">
        <div class="etag">Total: ${r(e.total)}</div>
        <div class="etag">Baki: ${r(remAmt)}</div>
        <div class="etag" style="color:${clr}">Paid: ${r(e.paid*e.emi)}</div>
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WHATSAPP SHARE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openWa(txnId){
  waTxnId=txnId; waType='single';
  document.querySelectorAll('[data-wt]').forEach(c=>c.classList.toggle('sel',c.dataset.wt==='single'));
  updateWaPreview();
  openM('waModal');
}
function setWaType(el){
  document.querySelectorAll('[data-wt]').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel'); waType=el.dataset.wt;
  updateWaPreview();
}
function updateWaPreview(){
  const app='üìä *MyKharcha*';
  let msg='';
  if(waType==='single'&&waTxnId){
    const t=DS.txns.find(x=>x.id===waTxnId);
    if(t){
      const cats=t.type==='expense'?ECATS:ICATS;
      const cat=cats.find(c=>c.id===t.cat)||{n:t.cat};
      msg=`${app}\n\n${t.type==='expense'?'üí∏ Kharcha':'üí∞ Amdani'} Record\n\nüí∞ Amount: *${r(t.amount)}*\nüìÇ Category: ${cat.n}\nüìÖ Date: ${t.date} ${t.time||''}\n${t.type==='expense'?`üí≥ Payment: ${t.pay}\n`:''}\nüìù Note: ${t.note||'‚Äî'}\n\n_MyKharcha se share kiya_`;
    }
  } else if(waType==='today'){
    const today=toDS(new Date());
    const tt=DS.txns.filter(t=>t.date===today);
    const ex=tt.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);
    const inc=tt.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
    msg=`${app}\n\nüìÖ *Aaj ka Summary* (${today})\n\nüí∏ Kharcha: *${r(ex)}*\nüí∞ Amdani: *${r(inc)}*\nüíö Balance: *${r(inc-ex)}*\nüìä Transactions: ${tt.length}\n\n_MyKharcha se share kiya_`;
  } else if(waType==='month'){
    const now=new Date(),m=now.getMonth(),y=now.getFullYear();
    const mE=DS.txns.filter(t=>t.type==='expense'&&smth(t.date,m,y));
    const mI=DS.txns.filter(t=>t.type==='income'&&smth(t.date,m,y));
    const eT=sm(mE),iT=sm(mI);
    const mn=now.toLocaleDateString('en-IN',{month:'long',year:'numeric'});
    const topC=ECATS.map(c=>({...c,t:mE.filter(x=>x.cat===c.id).reduce((s,x)=>s+x.amount,0)})).sort((a,b)=>b.t-a.t)[0];
    msg=`${app}\n\nüìÖ *${mn} Report*\n\nüí∏ Kharcha: *${r(eT)}*\nüí∞ Amdani: *${r(iT)}*\nüíö Bachat: *${r(Math.max(0,iT-eT))}*\nüìä Transactions: ${mE.length+mI.length}\n${topC&&topC.t>0?`üèÜ Top: ${topC.n} (${r(topC.t)})\n`:''}\n_MyKharcha se share kiya_`;
  }
  qs('#waPreview').textContent=msg||'Share type select karein';
}
function doWaShare(){
  const msg=qs('#waPreview').textContent;
  if(!msg||msg==='Share type select karein'){toast('Pehle type select karein','err');return;}
  window.open('https://wa.me/?text='+encodeURIComponent(msg),'_blank');
  closeM('waModal');toast('WhatsApp khul raha hai! ‚úì','ok');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BUDGET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function chgBMonth(d){bMonth+=d;if(bMonth<0){bMonth=11;bYear--;}if(bMonth>11){bMonth=0;bYear++;}renderBudget();}
function buildBudgetInps(){
  qs('#budgetInpsList').innerHTML=ECATS.map(c=>`
    <div class="fg">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
        <span class="material-icons-round" style="color:${c.c};font-size:16px">${c.ico}</span>
        <label class="fl" style="margin-bottom:0">${c.n} Budget (‚Çπ)</label>
      </div>
      <input type="number" class="fi" id="bg_${c.id}" placeholder="0 = koi limit nahi" value="${DS.budgets[c.id]||''}">
    </div>`).join('');
}
function saveBudgets(){
  ECATS.forEach(c=>{const v=parseFloat(qs('#bg_'+c.id).value)||0;if(v>0) DS.budgets[c.id]=v;else delete DS.budgets[c.id];});
  sBg();closeM('budgetEditModal');renderBudget();toast('Budgets save hua! ‚úì','ok');
}
function renderBudget(){
  qs('#budgetMonthTitle').textContent=new Date(bYear,bMonth).toLocaleDateString('en-IN',{month:'long',year:'numeric'});
  const mE=DS.txns.filter(t=>t.type==='expense'&&smth(t.date,bMonth,bYear));
  const totalB=Object.values(DS.budgets).reduce((s,v)=>s+v,0);
  const totalS=sm(mE), rem=Math.max(0,totalB-totalS);
  const pct=totalB>0?Math.min(100,(totalS/totalB)*100).toFixed(0):0;
  qs('#budgetTotal').textContent=r(totalB);
  qs('#budgetSub').textContent=totalB>0?`Is mahine ka total budget`:'Abhi koi budget set nahi ‚Äî "Edit Budgets" dabao';
  qs('#budgetSpent').textContent=r(totalS);
  qs('#budgetLeft').textContent=r(rem);
  qs('#budgetPct').textContent=pct+'%';
  const bcl=qs('#budgetCatList');
  const cd=ECATS.map(c=>{const sp=mE.filter(t=>t.cat===c.id).reduce((s,t)=>s+t.amount,0);const bg=DS.budgets[c.id]||0;return{...c,sp,bg};}).filter(c=>c.sp>0||c.bg>0).sort((a,b)=>b.sp-a.sp);
  if(!cd.length){bcl.innerHTML='<div class="empty" style="padding:20px 0"><p>Is mahine koi kharcha ya budget nahi</p></div>';return;}
  bcl.innerHTML=cd.map(c=>{
    const p2=c.bg>0?Math.min(100,(c.sp/c.bg)*100).toFixed(0):(c.sp>0?100:0);
    const fc=c.bg>0?(c.sp/c.bg>1?'ov':c.sp/c.bg>0.8?'wn':'sf'):'sf';
    return`<div class="bcitem">
      <div class="bctop"><div class="bcico" style="background:${c.c}18"><span class="material-icons-round" style="color:${c.c}">${c.ico}</span></div><div class="bcn">${c.n}</div><div class="bcp">${p2}%</div></div>
      <div class="bcamts"><span class="bcsp" style="color:${c.c}">${r(c.sp)} kharch</span><span class="bcbg">${c.bg>0?r(c.bg)+' budget':'Limit nahi'}</span></div>
      <div class="bcbar"><div class="bcfill ${fc}" style="width:${p2}%;background:${c.c}"></div></div>
    </div>`;
  }).join('');
  buildBudgetChart(cd);
}
function buildBudgetChart(cd){
  if(budgetC){budgetC.destroy();budgetC=null;}
  const o=cO();
  budgetC=new Chart(qs('#budgetChart'),{type:'bar',data:{labels:cd.map(c=>c.n),datasets:[{label:'Kharch',data:cd.map(c=>c.sp),backgroundColor:'rgba(255,95,126,.75)',borderRadius:6,borderSkipped:false},{label:'Budget',data:cd.map(c=>c.bg),backgroundColor:'rgba(139,127,255,.35)',borderRadius:6,borderSkipped:false}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{color:o.t,font:{size:10}}}},scales:{x:{grid:{color:o.g},ticks:{color:o.t,font:{size:9}}},y:{grid:{color:o.g},ticks:{color:o.t,callback:v=>'‚Çπ'+v.toLocaleString('en-IN')}}}}});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSettings(){
  const s=DS.settings;
  qs('#tglTheme').classList.toggle('on',s.theme==='light');
  qs('#tglLimit').classList.toggle('on',!!s.limitEnabled);
  qs('#limitStTxt').textContent=s.limitEnabled&&s.dailyLimit?`‚Çπ${rfmt(s.dailyLimit)}/din active`:'Set nahi hua';
  qs('#limitForm').style.display=s.limitEnabled?'':'none';
  if(s.dailyLimit) qs('#limitInp').value=s.dailyLimit;
  qs('#tglPin').classList.toggle('on',!!s.pinEnabled);
  qs('#pinStTxt').textContent=s.pinEnabled?'Enabled ‚Äì change karne ke liye tap karein':'Disabled';
  // Goals
  const gl=qs('#goalsList');
  if(!DS.goals.length){gl.innerHTML='<div style="color:var(--txt3);font-size:12px;padding:3px 2px 9px">Koi goal nahi. Neeche add karein!</div>';return;}
  gl.innerHTML=DS.goals.map((g,i)=>{
    const pct=Math.min(100,(g.saved/g.target)*100).toFixed(0);
    return`<div class="gcard">
      <div class="gtop">
        <div><div class="gname">üéØ ${g.name}</div><div class="gamts">‚Çπ${rfmt(g.saved)} / ‚Çπ${rfmt(g.target)}</div></div>
        <button class="gdel" onclick="delGoal(${i})"><span class="material-icons-round">close</span></button>
      </div>
      <div class="gbar"><div class="gfill" style="width:${pct}%"></div></div>
      <div class="gpct">${pct}% complete</div>
    </div>`;
  }).join('');
}
function tglLimit(){DS.settings.limitEnabled=!DS.settings.limitEnabled;sS();renderSettings();renderDash();}
function saveLimit(){
  const v=parseFloat(qs('#limitInp').value);
  if(!v||v<=0){toast('Valid amount darj karein','err');return;}
  DS.settings.dailyLimit=v;sS();renderSettings();renderDash();toast('Limit save hua! ‚úì','ok');
}
async function checkFPSupport(){
  const el=qs('#fpSupTxt');
  if(window.PublicKeyCredential){
    try{const a=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();el.textContent=a?'‚úÖ Fingerprint/Face ID available':'‚ùå Is device mein biometric nahi';}
    catch{el.textContent='Check karna possible nahi';}
  } else el.textContent='‚ùå Browser support nahi karta';
}
function savePin(){
  const a=qs('#pinA').value, b=qs('#pinB').value;
  if(a.length!==4||!/^\d+$/.test(a)){toast('PIN 4 digits ka hona chahiye','err');return;}
  if(a!==b){toast('PINs match nahi karte','err');return;}
  DS.settings.pin=a;DS.settings.pinEnabled=true;sS();
  closeM('pinModal');renderSettings();toast('PIN lock enable hua! ‚úì','ok');
}
function disablePin(){
  DS.settings.pin='';DS.settings.pinEnabled=false;sS();
  closeM('pinModal');renderSettings();toast('Lock disable hua','ok');
}
function saveGoal(){
  const n=(qs('#gNameInp').value||'').trim();
  const t=parseFloat(qs('#gTargetInp').value);
  const sv=parseFloat(qs('#gSavedInp').value)||0;
  if(!n){toast('Goal ka naam darj karein','err');return;}
  if(!t||t<=0){toast('Valid target darj karein','err');return;}
  DS.goals.push({name:n,target:t,saved:sv});sG();
  closeM('goalModal');renderSettings();
  qs('#gNameInp').value='';qs('#gTargetInp').value='';qs('#gSavedInp').value='';
  toast('Goal add hua! ‚úì','ok');
}
function delGoal(i){
  if(!confirm('Goal delete karein?'))return;
  DS.goals.splice(i,1);sG();renderSettings();toast('Goal delete hua','err');
}
function clearAllData(){
  if(!confirm('SABABHI DATA DELETE KAREIN?\n\nYeh undo nahi hoga!'))return;
  DS.txns=[];DS.goals=[];DS.bills=[];DS.emis=[];DS.budgets={};
  sT();sG();sB();sE();sBg();renderDash();toast('Sab data clear hua','err');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LOCK SCREEN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initLock(){
  if(!DS.settings.pinEnabled)return;
  qs('#lkscr').style.display='flex';
  qs('#numpad').innerHTML=[1,2,3,4,5,6,7,8,9,'','0','‚å´'].map(n=>`<button class="nb" onclick="pinTap('${n}')">${n}</button>`).join('');
  setTimeout(tryFP,600);
}
async function tryFP(){
  const btn=qs('#fpbtn'), lbl=qs('#fplbl');
  if(!window.PublicKeyCredential){lbl.textContent='Biometric available nahi';return;}
  try{
    const a=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
    if(!a){lbl.textContent='Is device mein biometric nahi';return;}
    btn.classList.add('scanning');lbl.textContent='Fingerprint rakho ya Face ID use karo...';
    await navigator.credentials.get({publicKey:{challenge:crypto.getRandomValues(new Uint8Array(32)),allowCredentials:[],userVerification:'required',timeout:30000}});
    btn.classList.remove('scanning');
    qs('#lkscr').style.display='none';pinBuf='';
    toast('Biometric se unlock hua! ‚úì','ok');
  }catch(e){
    btn.classList.remove('scanning');lbl.textContent='PIN use karein';
  }
}
function pinTap(n){
  if(n==='') return;
  if(n==='‚å´') pinBuf=pinBuf.slice(0,-1);
  else if(pinBuf.length<4) pinBuf+=n;
  for(let i=0;i<4;i++) qs('#pd'+i).classList.toggle('on',i<pinBuf.length);
  if(pinBuf.length===4){
    if(pinBuf===DS.settings.pin){
      qs('#lkscr').style.display='none';pinBuf='';
      toast('Unlock hua! ‚úì','ok');
    } else {
      qs('#pinerr').textContent='Galat PIN, dobara try karein';
      setTimeout(()=>{pinBuf='';for(let i=0;i<4;i++) qs('#pd'+i).classList.remove('on');qs('#pinerr').textContent='';},700);
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportPDF(){
  if(!window.jspdf){toast('PDF library load ho rahi hai...','warn');return;}
  try{
    const{jsPDF}=window.jspdf;const doc=new jsPDF();
    doc.setFontSize(18);doc.setTextColor(139,127,255);doc.text('MyKharcha ‚Äì Expense Report',14,20);
    doc.setFontSize(10);doc.setTextColor(100,100,120);
    doc.text(`Generated: ${new Date().toLocaleDateString('en-IN')} | Total: ${DS.txns.length} transactions`,14,30);
    let y=44;doc.setFontSize(9);doc.setTextColor(50,50,60);
    const hds=['Date','Time','Type','Category','Amount','Payment','Note'];
    const xs=[14,36,54,72,100,127,154];
    hds.forEach((h,i)=>doc.text(h,xs[i],y));
    y+=2;doc.setDrawColor(139,127,255);doc.line(14,y,196,y);y+=6;
    DS.txns.slice(0,80).forEach(t=>{
      if(y>278){doc.addPage();y=20;}
      const cats=t.type==='expense'?ECATS:ICATS;
      const cat=cats.find(c=>c.id===t.cat)||{n:t.cat};
      doc.text(t.date||'',xs[0],y);doc.text((t.time||'').slice(0,5),xs[1],y);
      doc.text(t.type,xs[2],y);doc.text(cat.n,xs[3],y);
      doc.text('Rs.'+t.amount,xs[4],y);doc.text(t.pay||'-',xs[5],y);
      doc.text((t.note||'-').slice(0,18),xs[6],y);y+=6;
    });
    doc.save('MyKharcha_Report.pdf');toast('PDF export hua! ‚úì','ok');
  }catch(e){console.error(e);toast('PDF export fail hua: '+e.message,'err');}
}
function exportXLSX(){
  if(!window.XLSX){toast('Excel library load ho rahi hai...','warn');return;}
  try{
    const rows=DS.txns.map(t=>({Date:t.date,Time:t.time,Type:t.type,Category:t.cat,Amount:t.amount,Payment:t.pay||'',Note:t.note||''}));
    const ws=XLSX.utils.json_to_sheet(rows);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,'Transactions');
    XLSX.writeFile(wb,'MyKharcha.xlsx');
    toast('Excel export hua! ‚úì','ok');
  }catch(e){toast('Excel export fail: '+e.message,'err');}
}
function doBackup(){
  const data=JSON.stringify({txns:DS.txns,goals:DS.goals,bills:DS.bills,emis:DS.emis,settings:DS.settings,budgets:DS.budgets},null,2);
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([data],{type:'application/json'}));
  a.download=`MyKharcha_Backup_${toDS(new Date())}.json`;
  document.body.appendChild(a);a.click();document.body.removeChild(a);
  toast('Backup save hua! ‚úì','ok');
}
function doRestore(e){
  const f=e.target.files[0];if(!f)return;
  const rd=new FileReader();
  rd.onload=ev=>{
    try{
      const d=JSON.parse(ev.target.result);
      if(d.txns) DS.txns=d.txns;
      if(d.goals) DS.goals=d.goals;
      if(d.bills) DS.bills=d.bills;
      if(d.emis) DS.emis=d.emis;
      if(d.settings) DS.settings=Object.assign({},DS.settings,d.settings);
      if(d.budgets) DS.budgets=d.budgets;
      sT();sG();sB();sE();sS();sBg();
      renderDash();updNotif();
      toast('Data restore hua! ‚úì','ok');
    }catch(err){toast('Invalid backup file','err');}
  };
  rd.readAsText(f);e.target.value='';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const qs=s=>document.querySelector(s);
const r=n=>'‚Çπ'+(n||0).toLocaleString('en-IN',{maximumFractionDigits:0});
const rfmt=n=>(n||0).toLocaleString('en-IN');
const sm=arr=>arr.reduce((s,t)=>s+t.amount,0);
const toDS=d=>d.toISOString().split('T')[0];
const smth=(ds,m,y)=>{try{const d=new Date(ds);return d.getMonth()===m&&d.getFullYear()===y;}catch{return false;}};
function fmtDate(ds){
  try{
    const d=new Date(ds+'T00:00:00');const t=new Date();t.setHours(0,0,0,0);
    const diff=Math.round((t-d)/86400000);
    if(diff===0)return'Aaj';if(diff===1)return'Kal';
    return d.toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'2-digit'});
  }catch{return ds;}
}
let ttimer;
function toast(msg,type='ok'){
  const T=qs('#toast');
  qs('#tMsg').textContent=msg;
  qs('#tIco').textContent={ok:'check_circle',err:'error',warn:'warning_amber'}[type]||'info';
  T.className=`${type} on`;
  clearTimeout(ttimer);ttimer=setTimeout(()=>T.classList.remove('on'),3000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
load();
applyTheme(DS.settings.theme);
injectManifest();
regSW();

const _n=new Date();
qs('#hdrDate').textContent=_n.toLocaleDateString('en-IN',{weekday:'long',day:'numeric',month:'short'});
qs('#dateInp').value=toDS(_n);
qs('#timeInp').value=_n.toTimeString().slice(0,5);
qs('#bDueInp').value=toDS(_n);
qs('#eStartInp').value=toDS(_n);

buildCatChips();
renderDash();
updNotif();
initLock();
</script>
</body>
</html>
